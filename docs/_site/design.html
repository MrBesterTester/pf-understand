<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>System Design | Two Tutorials for Mojo using Pocket Flow</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="System Design" /> <meta name="author" content="Sam Kirk" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation generated using AI to explain codebases" /> <meta property="og:description" content="Documentation generated using AI to explain codebases" /> <link rel="canonical" href="http://localhost:4000/design.html" /> <meta property="og:url" content="http://localhost:4000/design.html" /> <meta property="og:site_name" content="Two Tutorials for Mojo using Pocket Flow" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="System Design" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Sam Kirk","url":"https://www.columbia.edu/~zh2408/"},"description":"Documentation generated using AI to explain codebases","headline":"System Design","url":"http://localhost:4000/design.html"}</script> <!-- End Jekyll SEO tag --> <!-- Add Mermaid support --> <script src="https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js"></script> <script> document.addEventListener("DOMContentLoaded", function() { mermaid.initialize({ startOnLoad: true, theme: "default" }); // Process code blocks document.querySelectorAll('pre code.language-mermaid').forEach(function(block) { // Create a div with class 'mermaid' var mermaidDiv = document.createElement('div'); mermaidDiv.className = 'mermaid'; mermaidDiv.innerHTML = block.textContent; // Replace the parent pre with the mermaid div block.parentNode.parentNode.replaceChild(mermaidDiv, block.parentNode); console.log("Processed Mermaid block:", mermaidDiv.innerHTML.substring(0, 50) + "..."); }); console.log("Mermaid initialization complete. Version:", mermaid.version()); }); </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Two Tutorials for Mojo using Pocket Flow </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Crawl4ai category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-crawl4AI/" class="nav-list-link">My Tutorial for Crawl4ai</a><ul class="nav-list"></ul></li><li class="nav-list-item active"><a href="/design.html" class="nav-list-link active">System Design</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Modular's Max category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/modular_max/" class="nav-list-link">My Tutorial for Modular's Max</a><ul class="nav-list"><li class="nav-list-item "><a href="/modular_max/01_settings___settings__class__.html" class="nav-list-link">Chapter 1: Settings Class</a></li><li class="nav-list-item "><a href="/modular_max/02_serving_api_layer__fastapi_app___routers__.html" class="nav-list-link">Chapter 2: Serving API Layer</a></li><li class="nav-list-item "><a href="/modular_max/03_llm_pipeline_orchestrator___tokengeneratorpipeline___.html" class="nav-list-link">Chapter 3: LLM Pipeline Orchestrator</a></li><li class="nav-list-item "><a href="/modular_max/04_model_worker_.html" class="nav-list-link">Chapter 4: Model Worker</a></li><li class="nav-list-item "><a href="/modular_max/05_scheduler___tokengenerationscheduler____embeddingsscheduler___.html" class="nav-list-link">Chapter 5: Scheduler</a></li><li class="nav-list-item "><a href="/modular_max/06_kv_cache_management_.html" class="nav-list-link">Chapter 6: KV Cache Management</a></li><li class="nav-list-item "><a href="/modular_max/07_enginequeue_.html" class="nav-list-link">Chapter 7: EngineQueue</a></li><li class="nav-list-item "><a href="/modular_max/08_telemetry_and_metrics___metrics____metricclient___.html" class="nav-list-link">Chapter 8: Telemetry and Metrics</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Mojo v1 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/mojo-v1/" class="nav-list-link">My Tutorial for Mojo v1</a><ul class="nav-list"><li class="nav-list-item "><a href="/mojo-v1/01_addressspace_.html" class="nav-list-link">Chapter 1: AddressSpace</a></li><li class="nav-list-item "><a href="/mojo-v1/02_unsafepointer_.html" class="nav-list-link">Chapter 2: UnsafePointer</a></li><li class="nav-list-item "><a href="/mojo-v1/03_indexlist_.html" class="nav-list-link">Chapter 3: IndexList</a></li><li class="nav-list-item "><a href="/mojo-v1/04_dimlist_.html" class="nav-list-link">Chapter 4: DimList</a></li><li class="nav-list-item "><a href="/mojo-v1/05_ndbuffer_.html" class="nav-list-link">Chapter 5: NDBuffer</a></li><li class="nav-list-item "><a href="/mojo-v1/06_n_d_to_1d_indexing_logic__strided_memory_access__.html" class="nav-list-link">Chapter 6: N-D to 1D Indexing Logic</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Mojo v2 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/mojo-v2/" class="nav-list-link">My Tutorial for Mojo v2</a><ul class="nav-list"><li class="nav-list-item "><a href="/mojo-v2/01_unsafepointer__as_used_by_ndbuffer__.html" class="nav-list-link">Chapter 1: UnsafePointer</a></li><li class="nav-list-item "><a href="/mojo-v2/02_dimlist_and_dim_.html" class="nav-list-link">Chapter 2: DimList and Dim</a></li><li class="nav-list-item "><a href="/mojo-v2/03_ndbuffer_.html" class="nav-list-link">Chapter 3: NDBuffer</a></li><li class="nav-list-item "><a href="/mojo-v2/04_strides_and_offset_computation_.html" class="nav-list-link">Chapter 4: Strides and Offset Computation</a></li><li class="nav-list-item "><a href="/mojo-v2/05_simd_data_access_.html" class="nav-list-link">Chapter 5: SIMD Data Access</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Crawl4AI category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Crawl4AI/" class="nav-list-link">Crawl4AI</a><ul class="nav-list"><li class="nav-list-item "><a href="/Crawl4AI/01_asynccrawlerstrategy.html" class="nav-list-link">AsyncCrawlerStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/01_configuration_system_.html" class="nav-list-link">Chapter 1: Configuration System</a></li><li class="nav-list-item "><a href="/Crawl4AI/02_asyncwebcrawler.html" class="nav-list-link">AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/Crawl4AI/02_asyncwebcrawler_.html" class="nav-list-link">Chapter 2: AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/Crawl4AI/03_content_extraction_pipeline_.html" class="nav-list-link">Chapter 3: Content Extraction Pipeline</a></li><li class="nav-list-item "><a href="/Crawl4AI/03_crawlerrunconfig.html" class="nav-list-link">CrawlerRunConfig</a></li><li class="nav-list-item "><a href="/Crawl4AI/04_contentscrapingstrategy.html" class="nav-list-link">ContentScrapingStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/04_url_filtering___scoring_.html" class="nav-list-link">Chapter 4: URL Filtering & Scoring</a></li><li class="nav-list-item "><a href="/Crawl4AI/05_deep_crawling_system_.html" class="nav-list-link">Chapter 5: Deep Crawling System</a></li><li class="nav-list-item "><a href="/Crawl4AI/05_relevantcontentfilter.html" class="nav-list-link">RelevantContentFilter</a></li><li class="nav-list-item "><a href="/Crawl4AI/06_caching_system_.html" class="nav-list-link">Chapter 6: Caching System</a></li><li class="nav-list-item "><a href="/Crawl4AI/06_extractionstrategy.html" class="nav-list-link">ExtractionStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/07_dispatcher_framework_.html" class="nav-list-link">Chapter 7: Dispatcher Framework</a></li><li class="nav-list-item "><a href="/Crawl4AI/07_crawlresult.html" class="nav-list-link">CrawlResult</a></li><li class="nav-list-item "><a href="/Crawl4AI/08_async_logging_infrastructure_.html" class="nav-list-link">Chapter 8: Async Logging Infrastructure</a></li><li class="nav-list-item "><a href="/Crawl4AI/08_deepcrawlstrategy.html" class="nav-list-link">DeepCrawlStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/09_api___docker_integration_.html" class="nav-list-link">Chapter 9: API & Docker Integration</a></li><li class="nav-list-item "><a href="/Crawl4AI/09_cachecontext___cachemode.html" class="nav-list-link">CacheContext & CacheMode</a></li><li class="nav-list-item "><a href="/Crawl4AI/10_basedispatcher.html" class="nav-list-link">BaseDispatcher</a></li></ul></li></ul> <div class="nav-category">Crawl4AI</div> <ul class="nav-list"></ul> <div class="nav-category">Modular Max</div> <ul class="nav-list"></ul> <div class="nav-category">Mojo (v1)</div> <ul class="nav-list"></ul> <div class="nav-category">Mojo (v2)</div> <ul class="nav-list"></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Two Tutorials for Mojo using Pocket Flow" aria-label="Search Two Tutorials for Mojo using Pocket Flow" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/MrBesterTester/pf-understand" class="site-button" > View on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="system-design-codebase-knowledge-builder"> <a href="#system-design-codebase-knowledge-builder" class="anchor-heading" aria-labelledby="system-design-codebase-knowledge-builder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> System Design: Codebase Knowledge Builder </h1> <blockquote> <p>Please DON’T remove notes for AI</p> </blockquote> <h2 id="requirements"> <a href="#requirements" class="anchor-heading" aria-labelledby="requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requirements </h2> <blockquote> <p>Notes for AI: Keep it simple and clear. If the requirements are abstract, write concrete user stories</p> </blockquote> <p><strong>User Story:</strong> As a developer onboarding to a new codebase, I want a tutorial automatically generated from its GitHub repository or local directory, optionally in a specific language. This tutorial should explain the core abstractions, their relationships (visualized), and how they work together, using beginner-friendly language, analogies, and multi-line descriptions where needed, so I can understand the project structure and key concepts quickly without manually digging through all the code.</p> <p><strong>Input:</strong></p> <ul> <li>A publicly accessible GitHub repository URL or a local directory path.</li> <li>A project name (optional, will be derived from the URL/directory if not provided).</li> <li>Desired language for the tutorial (optional, defaults to English).</li> </ul> <p><strong>Output:</strong></p> <ul> <li>A directory named after the project containing: <ul> <li>An <code class="language-plaintext highlighter-rouge">index.md</code> file with: <ul> <li>A high-level project summary (potentially translated).</li> <li>A Mermaid flowchart diagram visualizing relationships between abstractions (using potentially translated names/labels).</li> <li>An ordered list of links to chapter files (using potentially translated names).</li> </ul> </li> <li>Individual Markdown files for each chapter (<code class="language-plaintext highlighter-rouge">01_chapter_one.md</code>, <code class="language-plaintext highlighter-rouge">02_chapter_two.md</code>, etc.) detailing core abstractions in a logical order (potentially translated content).</li> </ul> </li> </ul> <h2 id="flow-design"> <a href="#flow-design" class="anchor-heading" aria-labelledby="flow-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Flow Design </h2> <blockquote> <p>Notes for AI:</p> <ol> <li>Consider the design patterns of agent, map-reduce, rag, and workflow. Apply them if they fit.</li> <li>Present a concise, high-level description of the workflow.</li> </ol> </blockquote> <h3 id="applicable-design-pattern"> <a href="#applicable-design-pattern" class="anchor-heading" aria-labelledby="applicable-design-pattern"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Applicable Design Pattern: </h3> <p>This project primarily uses a <strong>Workflow</strong> pattern to decompose the tutorial generation process into sequential steps. The chapter writing step utilizes a <strong>BatchNode</strong> (a form of MapReduce) to process each abstraction individually.</p> <ol> <li><strong>Workflow:</strong> The overall process follows a defined sequence: fetch code -&gt; identify abstractions -&gt; analyze relationships -&gt; determine order -&gt; write chapters -&gt; combine tutorial into files.</li> <li><strong>Batch Processing:</strong> The <code class="language-plaintext highlighter-rouge">WriteChapters</code> node processes each identified abstraction independently (map) before the final tutorial files are structured (reduce).</li> </ol> <h3 id="flow-high-level-design"> <a href="#flow-high-level-design" class="anchor-heading" aria-labelledby="flow-high-level-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Flow high-level Design: </h3> <ol> <li><strong><code class="language-plaintext highlighter-rouge">FetchRepo</code></strong>: Crawls the specified GitHub repository URL or local directory using appropriate utility (<code class="language-plaintext highlighter-rouge">crawl_github_files</code> or <code class="language-plaintext highlighter-rouge">crawl_local_files</code>), retrieving relevant source code file contents.</li> <li><strong><code class="language-plaintext highlighter-rouge">IdentifyAbstractions</code></strong>: Analyzes the codebase using an LLM to identify up to 10 core abstractions, generate beginner-friendly descriptions (potentially translated if language != English), and list the <em>indices</em> of files related to each abstraction.</li> <li><strong><code class="language-plaintext highlighter-rouge">AnalyzeRelationships</code></strong>: Uses an LLM to analyze the identified abstractions (referenced by index) and their related code to generate a high-level project summary and describe the relationships/interactions between these abstractions (summary and labels potentially translated if language != English), specifying <em>source</em> and <em>target</em> abstraction indices and a concise label for each interaction.</li> <li><strong><code class="language-plaintext highlighter-rouge">OrderChapters</code></strong>: Determines the most logical order (as indices) to present the abstractions in the tutorial, considering input context which might be translated. The output order itself is language-independent.</li> <li><strong><code class="language-plaintext highlighter-rouge">WriteChapters</code> (BatchNode)</strong>: Iterates through the ordered list of abstraction indices. For each abstraction, it calls an LLM to write a detailed, beginner-friendly chapter (content potentially fully translated if language != English), using the relevant code files (accessed via indices) and summaries of previously generated chapters (potentially translated) as context.</li> <li><strong><code class="language-plaintext highlighter-rouge">CombineTutorial</code></strong>: Creates an output directory, generates a Mermaid diagram from the relationship data (using potentially translated names/labels), and writes the project summary (potentially translated), relationship diagram, chapter links (using potentially translated names), and individually generated chapter files (potentially translated content) into it. Fixed text like “Chapters”, “Source Repository”, and the attribution footer remain in English.</li> </ol><pre><code class="language-mermaid">flowchart TD
    A[FetchRepo] --&gt; B[IdentifyAbstractions];
    B --&gt; C[AnalyzeRelationships];
    C --&gt; D[OrderChapters];
    D --&gt; E[Batch WriteChapters];
    E --&gt; F[CombineTutorial];
</code></pre><h2 id="utility-functions"> <a href="#utility-functions" class="anchor-heading" aria-labelledby="utility-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Utility Functions </h2> <blockquote> <p>Notes for AI:</p> <ol> <li>Understand the utility function definition thoroughly by reviewing the doc.</li> <li>Include only the necessary utility functions, based on nodes in the flow.</li> </ol> </blockquote> <ol> <li><strong><code class="language-plaintext highlighter-rouge">crawl_github_files</code></strong> (<code class="language-plaintext highlighter-rouge">utils/crawl_github_files.py</code>) - <em>External Dependency: requests, gitpython (optional for SSH)</em> <ul> <li><em>Input</em>: <code class="language-plaintext highlighter-rouge">repo_url</code> (str), <code class="language-plaintext highlighter-rouge">token</code> (str, optional), <code class="language-plaintext highlighter-rouge">max_file_size</code> (int, optional), <code class="language-plaintext highlighter-rouge">use_relative_paths</code> (bool, optional), <code class="language-plaintext highlighter-rouge">include_patterns</code> (set, optional), <code class="language-plaintext highlighter-rouge">exclude_patterns</code> (set, optional)</li> <li><em>Output</em>: <code class="language-plaintext highlighter-rouge">dict</code> containing <code class="language-plaintext highlighter-rouge">files</code> (dict[str, str]) and <code class="language-plaintext highlighter-rouge">stats</code>.</li> <li><em>Necessity</em>: Required by <code class="language-plaintext highlighter-rouge">FetchRepo</code> to download and read source code from GitHub if a <code class="language-plaintext highlighter-rouge">repo_url</code> is provided. Handles API calls or SSH cloning, filtering, and file reading.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">crawl_local_files</code></strong> (<code class="language-plaintext highlighter-rouge">utils/crawl_local_files.py</code>) - <em>External Dependency: None</em> <ul> <li><em>Input</em>: <code class="language-plaintext highlighter-rouge">directory</code> (str), <code class="language-plaintext highlighter-rouge">max_file_size</code> (int, optional), <code class="language-plaintext highlighter-rouge">use_relative_paths</code> (bool, optional), <code class="language-plaintext highlighter-rouge">include_patterns</code> (set, optional), <code class="language-plaintext highlighter-rouge">exclude_patterns</code> (set, optional)</li> <li><em>Output</em>: <code class="language-plaintext highlighter-rouge">dict</code> containing <code class="language-plaintext highlighter-rouge">files</code> (dict[str, str]).</li> <li><em>Necessity</em>: Required by <code class="language-plaintext highlighter-rouge">FetchRepo</code> to read source code from a local directory if a <code class="language-plaintext highlighter-rouge">local_dir</code> path is provided. Handles directory walking, filtering, and file reading.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">call_llm</code></strong> (<code class="language-plaintext highlighter-rouge">utils/call_llm.py</code>) - <em>External Dependency: LLM Provider API (e.g., Google GenAI)</em> <ul> <li><em>Input</em>: <code class="language-plaintext highlighter-rouge">prompt</code> (str), <code class="language-plaintext highlighter-rouge">use_cache</code> (bool, optional)</li> <li><em>Output</em>: <code class="language-plaintext highlighter-rouge">response</code> (str)</li> <li><em>Necessity</em>: Used by <code class="language-plaintext highlighter-rouge">IdentifyAbstractions</code>, <code class="language-plaintext highlighter-rouge">AnalyzeRelationships</code>, <code class="language-plaintext highlighter-rouge">OrderChapters</code>, and <code class="language-plaintext highlighter-rouge">WriteChapters</code> for code analysis and content generation. Needs careful prompt engineering and YAML validation (implicit via <code class="language-plaintext highlighter-rouge">yaml.safe_load</code> which raises errors).</li> </ul> </li> </ol> <h2 id="node-design"> <a href="#node-design" class="anchor-heading" aria-labelledby="node-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Node Design </h2> <h3 id="shared-store"> <a href="#shared-store" class="anchor-heading" aria-labelledby="shared-store"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Shared Store </h3> <blockquote> <p>Notes for AI: Try to minimize data redundancy</p> </blockquote> <p>The shared Store structure is organized as follows:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shared</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># --- Inputs ---
</span>    <span class="s">"repo_url"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c1"># Provided by the user/main script if using GitHub
</span>    <span class="s">"local_dir"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c1"># Provided by the user/main script if using local directory
</span>    <span class="s">"project_name"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c1"># Optional, derived from repo_url/local_dir if not provided
</span>    <span class="s">"github_token"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c1"># Optional, from argument or environment variable
</span>    <span class="s">"output_dir"</span><span class="p">:</span> <span class="s">"output"</span><span class="p">,</span> <span class="c1"># Default or user-specified base directory for output
</span>    <span class="s">"include_patterns"</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="c1"># File patterns to include
</span>    <span class="s">"exclude_patterns"</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="c1"># File patterns to exclude
</span>    <span class="s">"max_file_size"</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="c1"># Default or user-specified max file size
</span>    <span class="s">"language"</span><span class="p">:</span> <span class="s">"english"</span><span class="p">,</span> <span class="c1"># Default or user-specified language for the tutorial
</span>
    <span class="c1"># --- Intermediate/Output Data ---
</span>    <span class="s">"files"</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Output of FetchRepo: List of tuples (file_path: str, file_content: str)
</span>    <span class="s">"abstractions"</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Output of IdentifyAbstractions: List of {"name": str (potentially translated), "description": str (potentially translated), "files": [int]} (indices into shared["files"])
</span>    <span class="s">"relationships"</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># Output of AnalyzeRelationships
</span>         <span class="s">"summary"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c1"># Overall project summary (potentially translated)
</span>         <span class="s">"details"</span><span class="p">:</span> <span class="p">[]</span> <span class="c1"># List of {"from": int, "to": int, "label": str (potentially translated)} describing relationships between abstraction indices.
</span>     <span class="p">},</span>
    <span class="s">"chapter_order"</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Output of OrderChapters: List of indices into shared["abstractions"], determining tutorial order
</span>    <span class="s">"chapters"</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Output of WriteChapters: List of chapter content strings (Markdown, potentially translated), ordered according to chapter_order
</span>    <span class="s">"final_output_dir"</span><span class="p">:</span> <span class="bp">None</span> <span class="c1"># Output of CombineTutorial: Path to the final generated tutorial directory (e.g., "output/my_project")
</span><span class="p">}</span>
</code></pre></div></div> <h3 id="node-steps"> <a href="#node-steps" class="anchor-heading" aria-labelledby="node-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Node Steps </h3> <blockquote> <p>Notes for AI: Carefully decide whether to use Batch/Async Node/Flow. Removed explicit try/except in exec, relying on Node’s built-in fault tolerance.</p> </blockquote> <ol> <li><strong><code class="language-plaintext highlighter-rouge">FetchRepo</code></strong> <ul> <li><em>Purpose</em>: Download the repository code (from GitHub) or read from a local directory, loading relevant files into memory using the appropriate crawler utility.</li> <li><em>Type</em>: Regular</li> <li><em>Steps</em>: <ul> <li><code class="language-plaintext highlighter-rouge">prep</code>: Read <code class="language-plaintext highlighter-rouge">repo_url</code>, <code class="language-plaintext highlighter-rouge">local_dir</code>, <code class="language-plaintext highlighter-rouge">project_name</code>, <code class="language-plaintext highlighter-rouge">github_token</code>, <code class="language-plaintext highlighter-rouge">output_dir</code>, <code class="language-plaintext highlighter-rouge">include_patterns</code>, <code class="language-plaintext highlighter-rouge">exclude_patterns</code>, <code class="language-plaintext highlighter-rouge">max_file_size</code> from shared store. Determine <code class="language-plaintext highlighter-rouge">project_name</code> from <code class="language-plaintext highlighter-rouge">repo_url</code> or <code class="language-plaintext highlighter-rouge">local_dir</code> if not present in shared. Set <code class="language-plaintext highlighter-rouge">use_relative_paths</code> flag.</li> <li><code class="language-plaintext highlighter-rouge">exec</code>: If <code class="language-plaintext highlighter-rouge">repo_url</code> is present, call <code class="language-plaintext highlighter-rouge">crawl_github_files(...)</code>. Otherwise, call <code class="language-plaintext highlighter-rouge">crawl_local_files(...)</code>. Convert the resulting <code class="language-plaintext highlighter-rouge">files</code> dictionary into a list of <code class="language-plaintext highlighter-rouge">(path, content)</code> tuples.</li> <li><code class="language-plaintext highlighter-rouge">post</code>: Write the list of <code class="language-plaintext highlighter-rouge">files</code> tuples and the derived <code class="language-plaintext highlighter-rouge">project_name</code> (if applicable) to the shared store.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">IdentifyAbstractions</code></strong> <ul> <li><em>Purpose</em>: Analyze the code to identify key concepts/abstractions using indices. Generates potentially translated names and descriptions if language is not English.</li> <li><em>Type</em>: Regular</li> <li><em>Steps</em>: <ul> <li><code class="language-plaintext highlighter-rouge">prep</code>: Read <code class="language-plaintext highlighter-rouge">files</code> (list of tuples), <code class="language-plaintext highlighter-rouge">project_name</code>, and <code class="language-plaintext highlighter-rouge">language</code> from shared store. Create context using <code class="language-plaintext highlighter-rouge">create_llm_context</code> helper which adds file indices. Format the list of <code class="language-plaintext highlighter-rouge">index # path</code> for the prompt.</li> <li><code class="language-plaintext highlighter-rouge">exec</code>: Construct a prompt for <code class="language-plaintext highlighter-rouge">call_llm</code>. If language is not English, add instructions to generate <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">description</code> in the target language. Ask LLM to identify ~5-10 core abstractions, provide a simple description for each, and list the relevant <em>file indices</em> (e.g., <code class="language-plaintext highlighter-rouge">- 0 # path/to/file.py</code>). Request YAML list output. Parse and validate the YAML, ensuring indices are within bounds and converting entries like <code class="language-plaintext highlighter-rouge">0 # path...</code> to just the integer <code class="language-plaintext highlighter-rouge">0</code>.</li> <li><code class="language-plaintext highlighter-rouge">post</code>: Write the validated list of <code class="language-plaintext highlighter-rouge">abstractions</code> (e.g., <code class="language-plaintext highlighter-rouge">[{"name": "Node", "description": "...", "files": [0, 3, 5]}, ...]</code>) containing file <em>indices</em> and potentially translated <code class="language-plaintext highlighter-rouge">name</code>/<code class="language-plaintext highlighter-rouge">description</code> to the shared store.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">AnalyzeRelationships</code></strong> <ul> <li><em>Purpose</em>: Generate a project summary and describe how the identified abstractions interact using indices and concise labels. Generates potentially translated summary and labels if language is not English.</li> <li><em>Type</em>: Regular</li> <li><em>Steps</em>: <ul> <li><code class="language-plaintext highlighter-rouge">prep</code>: Read <code class="language-plaintext highlighter-rouge">abstractions</code>, <code class="language-plaintext highlighter-rouge">files</code>, <code class="language-plaintext highlighter-rouge">project_name</code>, and <code class="language-plaintext highlighter-rouge">language</code> from shared store. Format context for the LLM, including potentially translated abstraction names <em>and indices</em>, potentially translated descriptions, and content snippets from related files (referenced by <code class="language-plaintext highlighter-rouge">index # path</code> using <code class="language-plaintext highlighter-rouge">get_content_for_indices</code> helper). Prepare the list of <code class="language-plaintext highlighter-rouge">index # AbstractionName</code> (potentially translated) for the prompt.</li> <li><code class="language-plaintext highlighter-rouge">exec</code>: Construct a prompt for <code class="language-plaintext highlighter-rouge">call_llm</code>. If language is not English, add instructions to generate <code class="language-plaintext highlighter-rouge">summary</code> and <code class="language-plaintext highlighter-rouge">label</code> in the target language, and note that input names might be translated. Ask for (1) a high-level summary and (2) a list of relationships, each specifying <code class="language-plaintext highlighter-rouge">from_abstraction</code> (e.g., <code class="language-plaintext highlighter-rouge">0 # Abstraction1</code>), <code class="language-plaintext highlighter-rouge">to_abstraction</code> (e.g., <code class="language-plaintext highlighter-rouge">1 # Abstraction2</code>), and a concise <code class="language-plaintext highlighter-rouge">label</code>. Request structured YAML output. Parse and validate, converting referenced abstractions to indices (<code class="language-plaintext highlighter-rouge">from: 0, to: 1</code>).</li> <li><code class="language-plaintext highlighter-rouge">post</code>: Parse the LLM response and write the <code class="language-plaintext highlighter-rouge">relationships</code> dictionary (<code class="language-plaintext highlighter-rouge">{"summary": "...", "details": [{"from": 0, "to": 1, "label": "..."}, ...]}</code>) with indices and potentially translated <code class="language-plaintext highlighter-rouge">summary</code>/<code class="language-plaintext highlighter-rouge">label</code> to the shared store.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">OrderChapters</code></strong> <ul> <li><em>Purpose</em>: Determine the sequence (as indices) in which abstractions should be presented. Considers potentially translated input context.</li> <li><em>Type</em>: Regular</li> <li><em>Steps</em>: <ul> <li><code class="language-plaintext highlighter-rouge">prep</code>: Read <code class="language-plaintext highlighter-rouge">abstractions</code>, <code class="language-plaintext highlighter-rouge">relationships</code>, <code class="language-plaintext highlighter-rouge">project_name</code>, and <code class="language-plaintext highlighter-rouge">language</code> from the shared store. Prepare context including the list of <code class="language-plaintext highlighter-rouge">index # AbstractionName</code> (potentially translated) and textual descriptions of relationships referencing indices and using the potentially translated <code class="language-plaintext highlighter-rouge">label</code>. Note in context if summary/names might be translated.</li> <li><code class="language-plaintext highlighter-rouge">exec</code>: Construct a prompt for <code class="language-plaintext highlighter-rouge">call_llm</code> asking it to order the abstractions based on importance, foundational concepts, or dependencies. Request output as an ordered YAML list of <code class="language-plaintext highlighter-rouge">index # AbstractionName</code>. Parse and validate, extracting only the indices and ensuring all are present exactly once.</li> <li><code class="language-plaintext highlighter-rouge">post</code>: Write the validated ordered list of indices (<code class="language-plaintext highlighter-rouge">chapter_order</code>) to the shared store.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">WriteChapters</code></strong> <ul> <li><em>Purpose</em>: Generate the detailed content for each chapter of the tutorial. Generates potentially fully translated chapter content if language is not English.</li> <li><em>Type</em>: <strong>BatchNode</strong></li> <li><em>Steps</em>: <ul> <li><code class="language-plaintext highlighter-rouge">prep</code>: Read <code class="language-plaintext highlighter-rouge">chapter_order</code> (indices), <code class="language-plaintext highlighter-rouge">abstractions</code>, <code class="language-plaintext highlighter-rouge">files</code>, <code class="language-plaintext highlighter-rouge">project_name</code>, and <code class="language-plaintext highlighter-rouge">language</code> from shared store. Initialize an empty instance variable <code class="language-plaintext highlighter-rouge">self.chapters_written_so_far</code>. Return an iterable list where each item corresponds to an <em>abstraction index</em> from <code class="language-plaintext highlighter-rouge">chapter_order</code>. Each item should contain chapter number, potentially translated abstraction details, a map of related file content (<code class="language-plaintext highlighter-rouge">{ "idx # path": content }</code>), full chapter listing (potentially translated names), chapter filename map, previous/next chapter info (potentially translated names), and language.</li> <li><code class="language-plaintext highlighter-rouge">exec(item)</code>: Construct a prompt for <code class="language-plaintext highlighter-rouge">call_llm</code>. If language is not English, add detailed instructions to write the <em>entire</em> chapter in the target language, translating explanations, examples, etc., while noting which input context might already be translated. Ask LLM to write a beginner-friendly Markdown chapter. Provide potentially translated concept details. Include a summary of previously written chapters (potentially translated). Provide relevant code snippets. Add the generated (potentially translated) chapter content to <code class="language-plaintext highlighter-rouge">self.chapters_written_so_far</code> for the next iteration’s context. Return the chapter content.</li> <li><code class="language-plaintext highlighter-rouge">post(shared, prep_res, exec_res_list)</code>: <code class="language-plaintext highlighter-rouge">exec_res_list</code> contains the generated chapter Markdown content strings (potentially translated), ordered correctly. Assign this list directly to <code class="language-plaintext highlighter-rouge">shared["chapters"]</code>. Clean up <code class="language-plaintext highlighter-rouge">self.chapters_written_so_far</code>.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">CombineTutorial</code></strong> <ul> <li><em>Purpose</em>: Assemble the final tutorial files, including a Mermaid diagram using potentially translated labels/names. Fixed text remains English.</li> <li><em>Type</em>: Regular</li> <li><em>Steps</em>: <ul> <li><code class="language-plaintext highlighter-rouge">prep</code>: Read <code class="language-plaintext highlighter-rouge">project_name</code>, <code class="language-plaintext highlighter-rouge">relationships</code> (potentially translated summary/labels), <code class="language-plaintext highlighter-rouge">chapter_order</code> (indices), <code class="language-plaintext highlighter-rouge">abstractions</code> (potentially translated name/desc), <code class="language-plaintext highlighter-rouge">chapters</code> (list of potentially translated content), <code class="language-plaintext highlighter-rouge">repo_url</code>, and <code class="language-plaintext highlighter-rouge">output_dir</code> from shared store. Generate a Mermaid <code class="language-plaintext highlighter-rouge">flowchart TD</code> string based on <code class="language-plaintext highlighter-rouge">relationships["details"]</code>, using indices to identify nodes (potentially translated names) and the concise <code class="language-plaintext highlighter-rouge">label</code> (potentially translated) for edges. Construct the content for <code class="language-plaintext highlighter-rouge">index.md</code> (including potentially translated summary, Mermaid diagram, and ordered links to chapters using potentially translated names derived using <code class="language-plaintext highlighter-rouge">chapter_order</code> and <code class="language-plaintext highlighter-rouge">abstractions</code>). Define the output directory path (e.g., <code class="language-plaintext highlighter-rouge">./output_dir/project_name</code>). Prepare a list of <code class="language-plaintext highlighter-rouge">{ "filename": "01_...", "content": "..." }</code> for chapters, adding the English attribution footer to each chapter’s content. Add the English attribution footer to the index content.</li> <li><code class="language-plaintext highlighter-rouge">exec</code>: Create the output directory. Write the generated <code class="language-plaintext highlighter-rouge">index.md</code> content. Iterate through the prepared chapter file list and write each chapter’s content to its corresponding <code class="language-plaintext highlighter-rouge">.md</code> file in the output directory.</li> <li><code class="language-plaintext highlighter-rouge">post</code>: Write the final <code class="language-plaintext highlighter-rouge">output_path</code> to <code class="language-plaintext highlighter-rouge">shared["final_output_dir"]</code>. Log completion.</li> </ul> </li> </ul> </li> </ol> </main> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2023 Sam Kirk</p> </footer> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
