<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Chapter 1: AddressSpace | Two Tutorials for Mojo using Pocket Flow</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="Chapter 1: AddressSpace" /> <meta name="author" content="Sam Kirk" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation generated using AI to explain codebases" /> <meta property="og:description" content="Documentation generated using AI to explain codebases" /> <link rel="canonical" href="http://localhost:4000/mojo-v1/01_addressspace_.html" /> <meta property="og:url" content="http://localhost:4000/mojo-v1/01_addressspace_.html" /> <meta property="og:site_name" content="Two Tutorials for Mojo using Pocket Flow" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Chapter 1: AddressSpace" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Sam Kirk","url":"https://www.linkedin.com/in/samuelkirk"},"description":"Documentation generated using AI to explain codebases","headline":"Chapter 1: AddressSpace","url":"http://localhost:4000/mojo-v1/01_addressspace_.html"}</script> <!-- End Jekyll SEO tag --> <!-- Add Mermaid support --> <script src="https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js"></script> <script> document.addEventListener("DOMContentLoaded", function() { mermaid.initialize({ startOnLoad: true, theme: "default" }); // Process code blocks document.querySelectorAll('pre code.language-mermaid').forEach(function(block) { // Create a div with class 'mermaid' var mermaidDiv = document.createElement('div'); mermaidDiv.className = 'mermaid'; mermaidDiv.innerHTML = block.textContent; // Replace the parent pre with the mermaid div block.parentNode.parentNode.replaceChild(mermaidDiv, block.parentNode); console.log("Processed Mermaid block:", mermaidDiv.innerHTML.substring(0, 50) + "..."); }); console.log("Mermaid initialization complete. Version:", mermaid.version()); }); </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Two Tutorials for Mojo using Pocket Flow </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">README</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Crawl4AI category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Crawl4AI/" class="nav-list-link">Crawl4AI</a><ul class="nav-list"><li class="nav-list-item "><a href="/Crawl4AI/01_asynccrawlerstrategy.html" class="nav-list-link">AsyncCrawlerStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/01_configuration_system_.html" class="nav-list-link">Chapter 1: Configuration System</a></li><li class="nav-list-item "><a href="/Crawl4AI/02_asyncwebcrawler.html" class="nav-list-link">AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/Crawl4AI/02_asyncwebcrawler_.html" class="nav-list-link">Chapter 2: AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/Crawl4AI/03_content_extraction_pipeline_.html" class="nav-list-link">Chapter 3: Content Extraction Pipeline</a></li><li class="nav-list-item "><a href="/Crawl4AI/03_crawlerrunconfig.html" class="nav-list-link">CrawlerRunConfig</a></li><li class="nav-list-item "><a href="/Crawl4AI/04_contentscrapingstrategy.html" class="nav-list-link">ContentScrapingStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/04_url_filtering___scoring_.html" class="nav-list-link">Chapter 4: URL Filtering & Scoring</a></li><li class="nav-list-item "><a href="/Crawl4AI/05_deep_crawling_system_.html" class="nav-list-link">Chapter 5: Deep Crawling System</a></li><li class="nav-list-item "><a href="/Crawl4AI/05_relevantcontentfilter.html" class="nav-list-link">RelevantContentFilter</a></li><li class="nav-list-item "><a href="/Crawl4AI/06_caching_system_.html" class="nav-list-link">Chapter 6: Caching System</a></li><li class="nav-list-item "><a href="/Crawl4AI/06_extractionstrategy.html" class="nav-list-link">ExtractionStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/07_crawlresult.html" class="nav-list-link">CrawlResult</a></li><li class="nav-list-item "><a href="/Crawl4AI/07_dispatcher_framework_.html" class="nav-list-link">Chapter 7: Dispatcher Framework</a></li><li class="nav-list-item "><a href="/Crawl4AI/08_async_logging_infrastructure_.html" class="nav-list-link">Chapter 8: Async Logging Infrastructure</a></li><li class="nav-list-item "><a href="/Crawl4AI/08_deepcrawlstrategy.html" class="nav-list-link">DeepCrawlStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/09_cachecontext___cachemode.html" class="nav-list-link">CacheContext & CacheMode</a></li><li class="nav-list-item "><a href="/Crawl4AI/09_api___docker_integration_.html" class="nav-list-link">Chapter 9: API & Docker Integration</a></li><li class="nav-list-item "><a href="/Crawl4AI/10_basedispatcher.html" class="nav-list-link">BaseDispatcher</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Crawl4ai category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-crawl4AI/" class="nav-list-link">My Tutorial for Crawl4ai</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-crawl4ai/01_configuration_system_.html" class="nav-list-link">Chapter 1: Configuration System</a></li><li class="nav-list-item "><a href="/my-crawl4ai/02_asyncwebcrawler_.html" class="nav-list-link">Chapter 2: AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/my-crawl4ai/03_content_extraction_pipeline_.html" class="nav-list-link">Chapter 3: Content Extraction Pipeline</a></li><li class="nav-list-item "><a href="/my-crawl4ai/04_url_filtering___scoring_.html" class="nav-list-link">Chapter 4: URL Filtering & Scoring</a></li><li class="nav-list-item "><a href="/my-crawl4ai/05_deep_crawling_system_.html" class="nav-list-link">Chapter 5: Deep Crawling System</a></li><li class="nav-list-item "><a href="/my-crawl4ai/06_caching_system_.html" class="nav-list-link">Chapter 6: Caching System</a></li><li class="nav-list-item "><a href="/my-crawl4ai/07_dispatcher_framework_.html" class="nav-list-link">Chapter 7: Dispatcher Framework</a></li><li class="nav-list-item "><a href="/my-crawl4ai/08_async_logging_infrastructure_.html" class="nav-list-link">Chapter 8: Async Logging Infrastructure</a></li><li class="nav-list-item "><a href="/my-crawl4ai/09_api___docker_integration_.html" class="nav-list-link">Chapter 9: API & Docker Integration</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Modular's Max category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/modular_max/" class="nav-list-link">My Tutorial for Modular's Max</a><ul class="nav-list"><li class="nav-list-item "><a href="/modular_max/01_settings___settings__class__.html" class="nav-list-link">Chapter 1: Settings Class</a></li><li class="nav-list-item "><a href="/modular_max/02_serving_api_layer__fastapi_app___routers__.html" class="nav-list-link">Chapter 2: Serving API Layer</a></li><li class="nav-list-item "><a href="/modular_max/03_llm_pipeline_orchestrator___tokengeneratorpipeline___.html" class="nav-list-link">Chapter 3: LLM Pipeline Orchestrator</a></li><li class="nav-list-item "><a href="/modular_max/04_model_worker_.html" class="nav-list-link">Chapter 4: Model Worker</a></li><li class="nav-list-item "><a href="/modular_max/05_scheduler___tokengenerationscheduler____embeddingsscheduler___.html" class="nav-list-link">Chapter 5: Scheduler</a></li><li class="nav-list-item "><a href="/modular_max/06_kv_cache_management_.html" class="nav-list-link">Chapter 6: KV Cache Management</a></li><li class="nav-list-item "><a href="/modular_max/07_enginequeue_.html" class="nav-list-link">Chapter 7: EngineQueue</a></li><li class="nav-list-item "><a href="/modular_max/08_telemetry_and_metrics___metrics____metricclient___.html" class="nav-list-link">Chapter 8: Telemetry and Metrics</a></li></ul></li><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Mojo v1 category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/mojo-v1/" class="nav-list-link">My Tutorial for Mojo v1</a><ul class="nav-list"><li class="nav-list-item active"><a href="/mojo-v1/01_addressspace_.html" class="nav-list-link active">Chapter 1: AddressSpace</a></li><li class="nav-list-item "><a href="/mojo-v1/02_unsafepointer_.html" class="nav-list-link">Chapter 2: UnsafePointer</a></li><li class="nav-list-item "><a href="/mojo-v1/03_indexlist_.html" class="nav-list-link">Chapter 3: IndexList</a></li><li class="nav-list-item "><a href="/mojo-v1/04_dimlist_.html" class="nav-list-link">Chapter 4: DimList</a></li><li class="nav-list-item "><a href="/mojo-v1/05_ndbuffer_.html" class="nav-list-link">Chapter 5: NDBuffer</a></li><li class="nav-list-item "><a href="/mojo-v1/06_n_d_to_1d_indexing_logic__strided_memory_access__.html" class="nav-list-link">Chapter 6: N-D to 1D Indexing Logic</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Mojo v2 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/mojo-v2/" class="nav-list-link">My Tutorial for Mojo v2</a><ul class="nav-list"><li class="nav-list-item "><a href="/mojo-v2/01_unsafepointer__as_used_by_ndbuffer__.html" class="nav-list-link">Chapter 1: UnsafePointer</a></li><li class="nav-list-item "><a href="/mojo-v2/02_dimlist_and_dim_.html" class="nav-list-link">Chapter 2: DimList and Dim</a></li><li class="nav-list-item "><a href="/mojo-v2/03_ndbuffer_.html" class="nav-list-link">Chapter 3: NDBuffer</a></li><li class="nav-list-item "><a href="/mojo-v2/04_strides_and_offset_computation_.html" class="nav-list-link">Chapter 4: Strides and Offset Computation</a></li><li class="nav-list-item "><a href="/mojo-v2/05_simd_data_access_.html" class="nav-list-link">Chapter 5: SIMD Data Access</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Comparisons category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/comparisons/" class="nav-list-link">Comparisons</a><ul class="nav-list"><li class="nav-list-item "><a href="/comparisons/crawl4ai-versions.html" class="nav-list-link">The original version of Crawl4AI vs. the sanity check I did</a></li><li class="nav-list-item "><a href="/comparisons/mojo-versions.html" class="nav-list-link">The 1st version of the Mojo Tutorial vs. The 2nd version of the Mojo Tutorial</a></li></ul></li><li class="nav-list-item"><a href="/generating/" class="nav-list-link">Generating & Preparing for the Mojo Tutorials using Pocket Flow</a></li><li class="nav-list-item"><a href="/design.html" class="nav-list-link">System Design</a></li></ul> <div class="nav-category">Crawl4AI</div> <ul class="nav-list"></ul> <div class="nav-category">Modular Max</div> <ul class="nav-list"></ul> <div class="nav-category">Mojo (v1)</div> <ul class="nav-list"></ul> <div class="nav-category">Mojo (v2)</div> <ul class="nav-list"></ul> <div class="nav-category">Generating</div> <ul class="nav-list"></ul> <div class="nav-category">AI Design</div> <ul class="nav-list"></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Two Tutorials for Mojo using Pocket Flow" aria-label="Search Two Tutorials for Mojo using Pocket Flow" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/MrBesterTester/pf-understand" class="site-button" > View on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/mojo-v1/">My Tutorial for Mojo v1</a></li> <li class="breadcrumb-nav-list-item"><span>Chapter 1: AddressSpace</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="chapter-1-understanding-memory-neighborhoods-with-addressspace"> <a href="#chapter-1-understanding-memory-neighborhoods-with-addressspace" class="anchor-heading" aria-labelledby="chapter-1-understanding-memory-neighborhoods-with-addressspace"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Chapter 1: Understanding Memory Neighborhoods with <code class="language-plaintext highlighter-rouge">AddressSpace</code> </h1> <p>Welcome to your first step into the world of Mojo! In this series, we’ll explore some fundamental concepts that help Mojo achieve its impressive performance, especially when dealing with different kinds of hardware like CPUs and GPUs.</p> <p>Our first topic is <code class="language-plaintext highlighter-rouge">AddressSpace</code>. It might sound a bit technical, but we’ll break it down with simple analogies.</p> <h2 id="what-is-addressspace"> <a href="#what-is-addressspace" class="anchor-heading" aria-labelledby="what-is-addressspace"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is <code class="language-plaintext highlighter-rouge">AddressSpace</code>? </h2> <p>Imagine a big city. This city has many different neighborhoods:</p> <ul> <li><strong>Downtown (CPU RAM)</strong>: This is your general-purpose area. Lots of things happen here, it’s accessible to everyone, and it’s where most everyday tasks are carried out.</li> <li><strong>Industrial Zone (GPU Global Memory)</strong>: A large area on specialized hardware (like a Graphics Processing Unit, or GPU) designed for heavy-duty work.</li> <li><strong>Specialized Workshops (GPU Shared/Constant Memory)</strong>: Smaller, super-fast areas within the Industrial Zone, designed for specific tasks or for workers (GPU threads) to collaborate very quickly.</li> </ul> <p>In Mojo, <code class="language-plaintext highlighter-rouge">AddressSpace</code> is a way to tell the system <strong>which “neighborhood” in memory a piece of data lives in.</strong></p> <p>The official description you saw earlier puts it nicely:</p> <blockquote> <p><code class="language-plaintext highlighter-rouge">AddressSpace</code> is a parameter that specifies the type or region of memory where the data an <code class="language-plaintext highlighter-rouge">NDBuffer</code> (a type we’ll see later) points to is located. Think of it like different neighborhoods in a city, each with its own characteristics and accessibility rules. For instance, <code class="language-plaintext highlighter-rouge">AddressSpace.GENERIC</code> might refer to standard CPU RAM, while other address spaces like <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.SHARED</code> or <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.CONSTANT</code> would indicate memory on a GPU with specific properties (e.g., shared among GPU threads or read-only constant data). The choice of <code class="language-plaintext highlighter-rouge">AddressSpace</code> is critical for performance and data management in systems with diverse memory types, particularly when programming for GPUs.</p> </blockquote> <p>So, <code class="language-plaintext highlighter-rouge">AddressSpace</code> helps Mojo understand the properties and location of memory.</p> <h2 id="why-do-we-need-different-memory-neighborhoods"> <a href="#why-do-we-need-different-memory-neighborhoods" class="anchor-heading" aria-labelledby="why-do-we-need-different-memory-neighborhoods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Why Do We Need Different Memory “Neighborhoods”? </h2> <p>Why not just have one giant memory area for everything?</p> <ol> <li><strong>Speed and Performance</strong>: Different types of memory have different speeds. <ul> <li>CPU RAM (our “Downtown”) is generally fast for a wide variety of tasks.</li> <li>GPU memory can be incredibly fast for certain parallel computations but might have different access patterns. Specialized parts of GPU memory (like “Workshops”) are even faster for specific uses. Telling Mojo where data is allows it to optimize how that data is accessed.</li> </ul> </li> <li><strong>Special Capabilities</strong>: Some memory regions have special properties. <ul> <li>For example, “shared memory” on a GPU allows multiple GPU processing units (threads) to share data very quickly, which is great for collaborative tasks.</li> <li>“Constant memory” on a GPU is for data that doesn’t change; the GPU can often cache this aggressively for faster reads.</li> </ul> </li> <li><strong>Hardware Differences</strong>: Modern computers often have both a CPU and one or more GPUs. These components have their own memory systems. <code class="language-plaintext highlighter-rouge">AddressSpace</code> helps manage data across these different pieces of hardware.</li> </ol> <p>Knowing the <code class="language-plaintext highlighter-rouge">AddressSpace</code> allows Mojo (and you, the programmer!) to make smart decisions about how to store and access data for optimal performance and correctness.</p> <h2 id="addressspace-in-mojo-a-closer-look"> <a href="#addressspace-in-mojo-a-closer-look" class="anchor-heading" aria-labelledby="addressspace-in-mojo-a-closer-look"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">AddressSpace</code> in Mojo: A Closer Look </h2> <p>Let’s peek at how <code class="language-plaintext highlighter-rouge">AddressSpace</code> is defined in Mojo’s standard library. You’ll find it in a file named <code class="language-plaintext highlighter-rouge">stdlib/src/memory/pointer.mojo</code>. Don’t worry about understanding all the code details yet; we’ll focus on the main ideas.</p><pre><code class="language-mojo">// From stdlib/src/memory/pointer.mojo

@value
@register_passable("trivial")
struct AddressSpace(...):
    """Address space of the pointer."""

    var _value: Int // Each address space has an underlying integer ID

    alias GENERIC = AddressSpace(0) // The most common one!
    """Generic address space."""

    // ... other details and functions ...

    @always_inline("builtin")
    fn __init__(out self, value: Int):
        """Initializes the address space from the underlying integral value."""
        self._value = value

    @always_inline("builtin")
    fn __init__(out self, value: _GPUAddressSpace): // Can also be made from a _GPUAddressSpace type
        """Initializes the address space from the underlying integral value."""
        self._value = value._value

// ... later in the same file ...

@value
@register_passable("trivial")
struct _GPUAddressSpace(EqualityComparable):
    var _value: Int

    // These are like pre-defined AddressSpace values for common GPU memory types
    alias GENERIC = AddressSpace(0) // GPUs can also access generic memory
    alias GLOBAL = AddressSpace(1)
    """Global address space (typically main GPU memory)."""
    alias SHARED = AddressSpace(3)
    """Shared address space (fast memory for GPU thread groups)."""
    alias CONSTANT = AddressSpace(4)
    """Constant address space (read-only, often cached)."""
    alias LOCAL = AddressSpace(5)
    """Local address space (private to a single GPU thread)."""

    // ... other details ...
</code></pre><p>Here’s what this means for a beginner:</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">struct AddressSpace</code></strong>: This defines the <code class="language-plaintext highlighter-rouge">AddressSpace</code> type. <ul> <li>The decorators <code class="language-plaintext highlighter-rouge">@value</code> and <code class="language-plaintext highlighter-rouge">@register_passable("trivial")</code> tell Mojo that <code class="language-plaintext highlighter-rouge">AddressSpace</code> is a simple value type that can be handled very efficiently. Think of it like a number.</li> <li><code class="language-plaintext highlighter-rouge">var _value: Int</code>: Internally, each <code class="language-plaintext highlighter-rouge">AddressSpace</code> is represented by an integer. For example, <code class="language-plaintext highlighter-rouge">0</code> means generic, <code class="language-plaintext highlighter-rouge">1</code> might mean global GPU memory, and so on.</li> <li><strong><code class="language-plaintext highlighter-rouge">alias GENERIC = AddressSpace(0)</code></strong>: This is a very important line! <code class="language-plaintext highlighter-rouge">AddressSpace.GENERIC</code> is the most common address space. It usually refers to standard CPU memory. If you don’t specify an address space, this is often the default.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">struct _GPUAddressSpace</code></strong>: This struct helps define common address spaces used with GPUs. <ul> <li><strong><code class="language-plaintext highlighter-rouge">alias GLOBAL = AddressSpace(1)</code></strong>: <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.GLOBAL</code> is a convenient name for <code class="language-plaintext highlighter-rouge">AddressSpace(1)</code>, which typically represents the main memory on a GPU.</li> <li><strong><code class="language-plaintext highlighter-rouge">alias SHARED = AddressSpace(3)</code></strong>: <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.SHARED</code> refers to <code class="language-plaintext highlighter-rouge">AddressSpace(3)</code>, a special, fast memory region that groups of GPU threads can use to share data.</li> <li><strong><code class="language-plaintext highlighter-rouge">alias CONSTANT = AddressSpace(4)</code></strong>: <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.CONSTANT</code> refers to <code class="language-plaintext highlighter-rouge">AddressSpace(4)</code>, used for data that won’t change during a computation. GPUs can optimize access to constant memory.</li> <li><strong><code class="language-plaintext highlighter-rouge">alias LOCAL = AddressSpace(5)</code></strong>: <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.LOCAL</code> refers to <code class="language-plaintext highlighter-rouge">AddressSpace(5)</code>, representing memory private to individual GPU threads.</li> </ul> </li> </ul> <p>So, you have <code class="language-plaintext highlighter-rouge">AddressSpace.GENERIC</code> for general CPU memory. For GPU-specific memory, you can use handy aliases like <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.GLOBAL</code> or <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.SHARED</code>. These aliases are actually <code class="language-plaintext highlighter-rouge">AddressSpace</code> values themselves.</p> <h2 id="how-is-addressspace-used"> <a href="#how-is-addressspace-used" class="anchor-heading" aria-labelledby="how-is-addressspace-used"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How is <code class="language-plaintext highlighter-rouge">AddressSpace</code> Used? </h2> <p>You’ll encounter <code class="language-plaintext highlighter-rouge">AddressSpace</code> as a parameter when you define types that manage memory, like <code class="language-plaintext highlighter-rouge">Pointer</code> (which represents a direct memory address) and <code class="language-plaintext highlighter-rouge">NDBuffer</code> (which represents an N-dimensional array of data, like a tensor or matrix).</p> <p>Look at how <code class="language-plaintext highlighter-rouge">Pointer</code> and <code class="language-plaintext highlighter-rouge">NDBuffer</code> use it (simplified from their definitions):</p><pre><code class="language-mojo">// From stdlib/src/memory/pointer.mojo
struct Pointer[
    // ... other parameters ...
    type: AnyType,
    address_space: AddressSpace = AddressSpace.GENERIC, // Default is GENERIC!
]:
    // ...

// From stdlib/src/buffer/buffer.mojo
struct NDBuffer[
    // ... other parameters ...
    type: DType,
    address_space: AddressSpace = AddressSpace.GENERIC, // Default is GENERIC!
    // ...
]:
    // ...
</code></pre><p>Notice the <code class="language-plaintext highlighter-rouge">address_space: AddressSpace = AddressSpace.GENERIC</code> part. This means:</p> <ul> <li>Both <code class="language-plaintext highlighter-rouge">Pointer</code> and <code class="language-plaintext highlighter-rouge">NDBuffer</code> need to know the <code class="language-plaintext highlighter-rouge">AddressSpace</code> of the memory they are dealing with.</li> <li>By default, if you don’t specify otherwise, they assume the memory is in <code class="language-plaintext highlighter-rouge">AddressSpace.GENERIC</code> (i.e., standard CPU RAM).</li> </ul> <p><strong>Conceptual Example:</strong></p> <p>Imagine you’re creating a buffer for some calculations.</p><pre><code class="language-mojo">// This is conceptual Mojo-like code to illustrate the idea

// A buffer in standard CPU memory (GENERIC is the default)
// let cpu_buffer = NDBuffer[Float32, ...]()

// A buffer specifically in GPU's global memory
// let gpu_global_buffer = NDBuffer[Float32, ..., address_space: _GPUAddressSpace.GLOBAL]()

// A buffer in fast GPU shared memory
// let gpu_shared_buffer = NDBuffer[Float32, ..., address_space: _GPUAddressSpace.SHARED]()
</code></pre><p>By specifying the <code class="language-plaintext highlighter-rouge">address_space</code>, you’re giving Mojo crucial information that it can use to manage and access the data efficiently.</p> <p><strong>Real-world Impact in <code class="language-plaintext highlighter-rouge">NDBuffer</code>:</strong></p> <p>The <code class="language-plaintext highlighter-rouge">NDBuffer</code> code itself makes decisions based on <code class="language-plaintext highlighter-rouge">AddressSpace</code>. For example, there’s a helper function in <code class="language-plaintext highlighter-rouge">stdlib/src/buffer/buffer.mojo</code>:</p><pre><code class="language-mojo">@always_inline
fn _use_32bit_indexing[address_space: AddressSpace]() -&gt; Bool:
    return is_gpu() and address_space in (
        _GPUAddressSpace.SHARED,
        _GPUAddressSpace.LOCAL,
        _GPUAddressSpace.CONSTANT,
    )
</code></pre><p>This function checks if the code is running on a GPU (<code class="language-plaintext highlighter-rouge">is_gpu()</code>) and if the <code class="language-plaintext highlighter-rouge">NDBuffer</code>’s data is in <code class="language-plaintext highlighter-rouge">SHARED</code>, <code class="language-plaintext highlighter-rouge">LOCAL</code>, or <code class="language-plaintext highlighter-rouge">CONSTANT</code> GPU memory. If so, it might decide to use 32-bit numbers for indexing into the buffer (which can sometimes be faster on GPUs for these memory types) instead of the usual 64-bit numbers. This is a direct example of <code class="language-plaintext highlighter-rouge">AddressSpace</code> influencing performance optimizations!</p> <h2 id="key-takeaways"> <a href="#key-takeaways" class="anchor-heading" aria-labelledby="key-takeaways"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Takeaways </h2> <ul> <li><code class="language-plaintext highlighter-rouge">AddressSpace</code> tells Mojo <strong>where data lives in memory</strong> (like different neighborhoods in a city).</li> <li><code class="language-plaintext highlighter-rouge">AddressSpace.GENERIC</code> is the common default, usually meaning <strong>standard CPU RAM</strong>.</li> <li>For GPUs, there are specific address spaces like <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.GLOBAL</code> (main GPU memory), <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.SHARED</code> (fast shared memory for GPU threads), and <code class="language-plaintext highlighter-rouge">_GPUAddressSpace.CONSTANT</code> (read-only cached memory).</li> <li>Knowing the <code class="language-plaintext highlighter-rouge">AddressSpace</code> is crucial for <strong>performance</strong> and <strong>correct data handling</strong>, especially when working with diverse hardware like GPUs.</li> <li>You’ll see <code class="language-plaintext highlighter-rouge">AddressSpace</code> as a parameter in memory-related types like <code class="language-plaintext highlighter-rouge">Pointer</code> and <code class="language-plaintext highlighter-rouge">NDBuffer</code>.</li> </ul> <p>Understanding <code class="language-plaintext highlighter-rouge">AddressSpace</code> is a foundational piece in learning how Mojo manages memory and achieves high performance. It’s all about giving the system enough information to make smart choices!</p> <h2 id="next-steps"> <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps </h2> <p>Now that you have a basic understanding of <code class="language-plaintext highlighter-rouge">AddressSpace</code>, we’re ready to explore how Mojo represents direct memory locations. In the next chapter, we’ll dive into <code class="language-plaintext highlighter-rouge">UnsafePointer</code>, a fundamental building block for memory operations in Mojo.</p><hr /> <p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p> </main> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
