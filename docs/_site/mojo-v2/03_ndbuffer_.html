<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Chapter 3: NDBuffer | Two Tutorials for Mojo using Pocket Flow</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="Chapter 3: NDBuffer" /> <meta name="author" content="Sam Kirk" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation generated using AI to explain codebases" /> <meta property="og:description" content="Documentation generated using AI to explain codebases" /> <link rel="canonical" href="http://localhost:4000/mojo-v2/03_ndbuffer_.html" /> <meta property="og:url" content="http://localhost:4000/mojo-v2/03_ndbuffer_.html" /> <meta property="og:site_name" content="Two Tutorials for Mojo using Pocket Flow" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Chapter 3: NDBuffer" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Sam Kirk","url":"https://www.linkedin.com/in/samuelkirk"},"description":"Documentation generated using AI to explain codebases","headline":"Chapter 3: NDBuffer","url":"http://localhost:4000/mojo-v2/03_ndbuffer_.html"}</script> <!-- End Jekyll SEO tag --> <!-- Add Mermaid support --> <script src="https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js"></script> <script> document.addEventListener("DOMContentLoaded", function() { mermaid.initialize({ startOnLoad: true, theme: "default" }); // Process code blocks document.querySelectorAll('pre code.language-mermaid').forEach(function(block) { // Create a div with class 'mermaid' var mermaidDiv = document.createElement('div'); mermaidDiv.className = 'mermaid'; mermaidDiv.innerHTML = block.textContent; // Replace the parent pre with the mermaid div block.parentNode.parentNode.replaceChild(mermaidDiv, block.parentNode); console.log("Processed Mermaid block:", mermaidDiv.innerHTML.substring(0, 50) + "..."); }); console.log("Mermaid initialization complete. Version:", mermaid.version()); }); </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Two Tutorials for Mojo using Pocket Flow </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">README</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Crawl4AI category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Crawl4AI/" class="nav-list-link">Crawl4AI</a><ul class="nav-list"><li class="nav-list-item "><a href="/Crawl4AI/01_asynccrawlerstrategy.html" class="nav-list-link">AsyncCrawlerStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/01_configuration_system_.html" class="nav-list-link">Chapter 1: Configuration System</a></li><li class="nav-list-item "><a href="/Crawl4AI/02_asyncwebcrawler.html" class="nav-list-link">AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/Crawl4AI/02_asyncwebcrawler_.html" class="nav-list-link">Chapter 2: AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/Crawl4AI/03_content_extraction_pipeline_.html" class="nav-list-link">Chapter 3: Content Extraction Pipeline</a></li><li class="nav-list-item "><a href="/Crawl4AI/03_crawlerrunconfig.html" class="nav-list-link">CrawlerRunConfig</a></li><li class="nav-list-item "><a href="/Crawl4AI/04_contentscrapingstrategy.html" class="nav-list-link">ContentScrapingStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/04_url_filtering___scoring_.html" class="nav-list-link">Chapter 4: URL Filtering & Scoring</a></li><li class="nav-list-item "><a href="/Crawl4AI/05_deep_crawling_system_.html" class="nav-list-link">Chapter 5: Deep Crawling System</a></li><li class="nav-list-item "><a href="/Crawl4AI/05_relevantcontentfilter.html" class="nav-list-link">RelevantContentFilter</a></li><li class="nav-list-item "><a href="/Crawl4AI/06_caching_system_.html" class="nav-list-link">Chapter 6: Caching System</a></li><li class="nav-list-item "><a href="/Crawl4AI/06_extractionstrategy.html" class="nav-list-link">ExtractionStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/07_crawlresult.html" class="nav-list-link">CrawlResult</a></li><li class="nav-list-item "><a href="/Crawl4AI/07_dispatcher_framework_.html" class="nav-list-link">Chapter 7: Dispatcher Framework</a></li><li class="nav-list-item "><a href="/Crawl4AI/08_async_logging_infrastructure_.html" class="nav-list-link">Chapter 8: Async Logging Infrastructure</a></li><li class="nav-list-item "><a href="/Crawl4AI/08_deepcrawlstrategy.html" class="nav-list-link">DeepCrawlStrategy</a></li><li class="nav-list-item "><a href="/Crawl4AI/09_cachecontext___cachemode.html" class="nav-list-link">CacheContext & CacheMode</a></li><li class="nav-list-item "><a href="/Crawl4AI/09_api___docker_integration_.html" class="nav-list-link">Chapter 9: API & Docker Integration</a></li><li class="nav-list-item "><a href="/Crawl4AI/10_basedispatcher.html" class="nav-list-link">BaseDispatcher</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Crawl4ai category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-crawl4AI/" class="nav-list-link">My Tutorial for Crawl4ai</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-crawl4ai/01_configuration_system_.html" class="nav-list-link">Chapter 1: Configuration System</a></li><li class="nav-list-item "><a href="/my-crawl4ai/02_asyncwebcrawler_.html" class="nav-list-link">Chapter 2: AsyncWebCrawler</a></li><li class="nav-list-item "><a href="/my-crawl4ai/03_content_extraction_pipeline_.html" class="nav-list-link">Chapter 3: Content Extraction Pipeline</a></li><li class="nav-list-item "><a href="/my-crawl4ai/04_url_filtering___scoring_.html" class="nav-list-link">Chapter 4: URL Filtering & Scoring</a></li><li class="nav-list-item "><a href="/my-crawl4ai/05_deep_crawling_system_.html" class="nav-list-link">Chapter 5: Deep Crawling System</a></li><li class="nav-list-item "><a href="/my-crawl4ai/06_caching_system_.html" class="nav-list-link">Chapter 6: Caching System</a></li><li class="nav-list-item "><a href="/my-crawl4ai/07_dispatcher_framework_.html" class="nav-list-link">Chapter 7: Dispatcher Framework</a></li><li class="nav-list-item "><a href="/my-crawl4ai/08_async_logging_infrastructure_.html" class="nav-list-link">Chapter 8: Async Logging Infrastructure</a></li><li class="nav-list-item "><a href="/my-crawl4ai/09_api___docker_integration_.html" class="nav-list-link">Chapter 9: API & Docker Integration</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Modular's Max category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/modular_max/" class="nav-list-link">My Tutorial for Modular's Max</a><ul class="nav-list"><li class="nav-list-item "><a href="/modular_max/01_settings___settings__class__.html" class="nav-list-link">Chapter 1: Settings Class</a></li><li class="nav-list-item "><a href="/modular_max/02_serving_api_layer__fastapi_app___routers__.html" class="nav-list-link">Chapter 2: Serving API Layer</a></li><li class="nav-list-item "><a href="/modular_max/03_llm_pipeline_orchestrator___tokengeneratorpipeline___.html" class="nav-list-link">Chapter 3: LLM Pipeline Orchestrator</a></li><li class="nav-list-item "><a href="/modular_max/04_model_worker_.html" class="nav-list-link">Chapter 4: Model Worker</a></li><li class="nav-list-item "><a href="/modular_max/05_scheduler___tokengenerationscheduler____embeddingsscheduler___.html" class="nav-list-link">Chapter 5: Scheduler</a></li><li class="nav-list-item "><a href="/modular_max/06_kv_cache_management_.html" class="nav-list-link">Chapter 6: KV Cache Management</a></li><li class="nav-list-item "><a href="/modular_max/07_enginequeue_.html" class="nav-list-link">Chapter 7: EngineQueue</a></li><li class="nav-list-item "><a href="/modular_max/08_telemetry_and_metrics___metrics____metricclient___.html" class="nav-list-link">Chapter 8: Telemetry and Metrics</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Mojo v1 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/mojo-v1/" class="nav-list-link">My Tutorial for Mojo v1</a><ul class="nav-list"><li class="nav-list-item "><a href="/mojo-v1/01_addressspace_.html" class="nav-list-link">Chapter 1: AddressSpace</a></li><li class="nav-list-item "><a href="/mojo-v1/02_unsafepointer_.html" class="nav-list-link">Chapter 2: UnsafePointer</a></li><li class="nav-list-item "><a href="/mojo-v1/03_indexlist_.html" class="nav-list-link">Chapter 3: IndexList</a></li><li class="nav-list-item "><a href="/mojo-v1/04_dimlist_.html" class="nav-list-link">Chapter 4: DimList</a></li><li class="nav-list-item "><a href="/mojo-v1/05_ndbuffer_.html" class="nav-list-link">Chapter 5: NDBuffer</a></li><li class="nav-list-item "><a href="/mojo-v1/06_n_d_to_1d_indexing_logic__strided_memory_access__.html" class="nav-list-link">Chapter 6: N-D to 1D Indexing Logic</a></li></ul></li><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in My Tutorial for Mojo v2 category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/mojo-v2/" class="nav-list-link">My Tutorial for Mojo v2</a><ul class="nav-list"><li class="nav-list-item "><a href="/mojo-v2/01_unsafepointer__as_used_by_ndbuffer__.html" class="nav-list-link">Chapter 1: UnsafePointer</a></li><li class="nav-list-item "><a href="/mojo-v2/02_dimlist_and_dim_.html" class="nav-list-link">Chapter 2: DimList and Dim</a></li><li class="nav-list-item active"><a href="/mojo-v2/03_ndbuffer_.html" class="nav-list-link active">Chapter 3: NDBuffer</a></li><li class="nav-list-item "><a href="/mojo-v2/04_strides_and_offset_computation_.html" class="nav-list-link">Chapter 4: Strides and Offset Computation</a></li><li class="nav-list-item "><a href="/mojo-v2/05_simd_data_access_.html" class="nav-list-link">Chapter 5: SIMD Data Access</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Comparisons category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/comparisons/" class="nav-list-link">Comparisons</a><ul class="nav-list"><li class="nav-list-item "><a href="/comparisons/crawl4ai-versions.html" class="nav-list-link">The original version of Crawl4AI vs. the sanity check I did</a></li><li class="nav-list-item "><a href="/comparisons/mojo-versions.html" class="nav-list-link">The 1st version of the Mojo Tutorial vs. The 2nd version of the Mojo Tutorial</a></li></ul></li><li class="nav-list-item"><a href="/generating/" class="nav-list-link">Generating & Preparing for the Mojo Tutorials using Pocket Flow</a></li><li class="nav-list-item"><a href="/design.html" class="nav-list-link">System Design</a></li></ul> <div class="nav-category">Crawl4AI</div> <ul class="nav-list"></ul> <div class="nav-category">Modular Max</div> <ul class="nav-list"></ul> <div class="nav-category">Mojo (v1)</div> <ul class="nav-list"></ul> <div class="nav-category">Mojo (v2)</div> <ul class="nav-list"></ul> <div class="nav-category">Generating</div> <ul class="nav-list"></ul> <div class="nav-category">AI Design</div> <ul class="nav-list"></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Two Tutorials for Mojo using Pocket Flow" aria-label="Search Two Tutorials for Mojo using Pocket Flow" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/MrBesterTester/pf-understand" class="site-button" > View on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/mojo-v2/">My Tutorial for Mojo v2</a></li> <li class="breadcrumb-nav-list-item"><span>Chapter 3: NDBuffer</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="chapter-3-ndbuffer"> <a href="#chapter-3-ndbuffer" class="anchor-heading" aria-labelledby="chapter-3-ndbuffer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Chapter 3: NDBuffer </h1> <p>Welcome back! In our Mojo journey so far, we’ve explored some fundamental building blocks:</p> <ul> <li>In <a href="01_unsafepointer__as_used_by_ndbuffer__.md">Chapter 1: Meet <code class="language-plaintext highlighter-rouge">UnsafePointer</code></a>, we learned that an <code class="language-plaintext highlighter-rouge">UnsafePointer</code> is like a direct street address to a location in your computer’s memory where data can be stored.</li> <li>In <a href="02_dimlist_and_dim_.md">Chapter 2: Defining Dimensions - <code class="language-plaintext highlighter-rouge">Dim</code> and <code class="language-plaintext highlighter-rouge">DimList</code></a>, we saw how <code class="language-plaintext highlighter-rouge">Dim</code> represents the size of a single dimension (which can be known at compile-time or runtime) and <code class="language-plaintext highlighter-rouge">DimList</code> collects these <code class="language-plaintext highlighter-rouge">Dim</code>s to describe the overall shape of multi-dimensional data.</li> </ul> <p>Now, it’s time to bring these concepts together and meet the star of our show: <code class="language-plaintext highlighter-rouge">NDBuffer</code>.</p> <p>The <code class="language-plaintext highlighter-rouge">NDBuffer</code> struct is central to handling multi-dimensional arrays (like vectors, matrices, or tensors) in Mojo. Think of it as a sophisticated “lens” or a “view” that you place over a raw block of memory. It doesn’t own the memory itself, but it tells Mojo how to <em>interpret</em> that memory as an N-dimensional structure.</p> <p>As described in the project:</p> <blockquote> <p>The <code class="language-plaintext highlighter-rouge">NDBuffer</code> struct is a non-owning, multi-dimensional view into a block of memory. It describes how to interpret a (potentially flat) piece of memory as an N-dimensional array (like a tensor or matrix). It achieves this by specifying the data type of elements (<code class="language-plaintext highlighter-rouge">type</code>), the number of dimensions (<code class="language-plaintext highlighter-rouge">rank</code>), the size of each dimension (<code class="language-plaintext highlighter-rouge">shape</code>), how to step through memory for each dimension (<code class="language-plaintext highlighter-rouge">strides</code>), the memory’s <code class="language-plaintext highlighter-rouge">origin</code> (related to aliasing and lifetime), and its <code class="language-plaintext highlighter-rouge">address_space</code> (e.g., CPU, GPU shared memory). <code class="language-plaintext highlighter-rouge">NDBuffer</code> itself doesn’t own the memory; it’s a descriptor or a “lens” for existing memory.</p> </blockquote> <p>Let’s dive into what makes an <code class="language-plaintext highlighter-rouge">NDBuffer</code> tick!</p> <h2 id="what-exactly-is-an-ndbuffer"> <a href="#what-exactly-is-an-ndbuffer" class="anchor-heading" aria-labelledby="what-exactly-is-an-ndbuffer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What Exactly is an <code class="language-plaintext highlighter-rouge">NDBuffer</code>? </h2> <p>Imagine you have a large, flat sheet of graph paper, and each square on the paper can hold a single number. This sheet of graph paper is like a block of memory.</p> <p>An <code class="language-plaintext highlighter-rouge">NDBuffer</code> is like an adjustable stencil or a set of instructions you lay over this graph paper. This stencil tells you:</p> <ul> <li><strong>What kind of numbers</strong> are in the squares (e.g., integers, decimal numbers).</li> <li><strong>How many rows and columns</strong> (or even more dimensions, like layers) you should consider.</li> <li><strong>The size of each row and column</strong>.</li> <li><strong>How many squares to jump</strong> to get from one number to the next, either across a row or down to the next row.</li> </ul> <p>Crucially, the <code class="language-plaintext highlighter-rouge">NDBuffer</code> is just the stencil/instructions. It doesn’t <em>contain</em> the graph paper (the memory) itself. It just knows <em>how to look at it</em>. This is why it’s called a “non-owning view.”</p> <h2 id="the-anatomy-of-an-ndbuffer"> <a href="#the-anatomy-of-an-ndbuffer" class="anchor-heading" aria-labelledby="the-anatomy-of-an-ndbuffer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Anatomy of an <code class="language-plaintext highlighter-rouge">NDBuffer</code> </h2> <p>Let’s peek inside the <code class="language-plaintext highlighter-rouge">NDBuffer</code> struct as defined in <code class="language-plaintext highlighter-rouge">stdlib/src/buffer/buffer.mojo</code>. We won’t look at every line, but we’ll focus on the main parts a beginner needs to understand.</p> <p>An <code class="language-plaintext highlighter-rouge">NDBuffer</code> is defined as a <code class="language-plaintext highlighter-rouge">struct</code>. When you create an <code class="language-plaintext highlighter-rouge">NDBuffer</code>, you’re creating an instance of this struct. It has several important <strong>parameters</strong> (information you provide when creating it) and internal <strong>fields</strong> (where it stores its state).</p> <h3 id="key-parameters-compile-time-information"> <a href="#key-parameters-compile-time-information" class="anchor-heading" aria-labelledby="key-parameters-compile-time-information"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Parameters (Compile-Time Information) </h3> <p>These are specified when you declare or create an <code class="language-plaintext highlighter-rouge">NDBuffer</code>. They help Mojo understand the <em>intended</em> structure and properties, often allowing for compile-time optimizations.</p><pre><code class="language-mojo">// Simplified NDBuffer definition from stdlib/src/buffer/buffer.mojo
struct NDBuffer[
    mut: Bool, // Can the data be modified through this NDBuffer?
    type: DType, // What's the data type of each element? (e.g., DType.float32)
    rank: Int, // How many dimensions? (e.g., 2 for a matrix)
    origin: Origin[mut], // Related to memory safety and lifetime tracking

    // These use DimList from Chapter 2!
    shape: DimList = DimList.create_unknown[rank](), // Compile-time description of dimension sizes
    strides: DimList = DimList.create_unknown[rank](), // Compile-time description of memory layout

    *, // Indicates subsequent parameters are keyword-only
    alignment: Int = 1, // Preferred memory alignment for performance
    address_space: AddressSpace = AddressSpace.GENERIC, // Where is the memory? (CPU, GPU)
    exclusive: Bool = True // Is this NDBuffer the only way to access the memory?
] {
    // ... Internal fields and methods ...
}
</code></pre><p>Let’s break these down:</p> <ul> <li><code class="language-plaintext highlighter-rouge">mut: Bool</code>: Short for “mutable.” If <code class="language-plaintext highlighter-rouge">True</code>, you can change the data elements in the <code class="language-plaintext highlighter-rouge">NDBuffer</code>. If <code class="language-plaintext highlighter-rouge">False</code>, it’s read-only.</li> <li><code class="language-plaintext highlighter-rouge">type: DType</code>: Specifies the data type of the elements stored. <code class="language-plaintext highlighter-rouge">DType</code> is Mojo’s way of representing types like <code class="language-plaintext highlighter-rouge">float32</code>, <code class="language-plaintext highlighter-rouge">int64</code>, etc.</li> <li><code class="language-plaintext highlighter-rouge">rank: Int</code>: The number of dimensions. A 1D array (vector) has <code class="language-plaintext highlighter-rouge">rank=1</code>. A 2D array (matrix) has <code class="language-plaintext highlighter-rouge">rank=2</code>. A 3D array (like a cube of data) has <code class="language-plaintext highlighter-rouge">rank=3</code>, and so on.</li> <li><code class="language-plaintext highlighter-rouge">origin: Origin[mut]</code>: An advanced Mojo concept related to memory ownership and borrowing rules. It helps Mojo track where the permission to access the memory came from, enhancing safety. It’s often tied to the <code class="language-plaintext highlighter-rouge">UnsafePointer</code> that the <code class="language-plaintext highlighter-rouge">NDBuffer</code> will use.</li> <li><code class="language-plaintext highlighter-rouge">shape: DimList</code>: This is where <code class="language-plaintext highlighter-rouge">DimList</code> (from Chapter 2) comes in! It’s a compile-time list of <code class="language-plaintext highlighter-rouge">Dim</code>s describing the <em>intended</em> size of each dimension. Some <code class="language-plaintext highlighter-rouge">Dim</code>s can be static (e.g., <code class="language-plaintext highlighter-rouge">Dim(10)</code>), and some can be dynamic (<code class="language-plaintext highlighter-rouge">Dim()</code>, meaning the size will be known at runtime). By default, it’s <code class="language-plaintext highlighter-rouge">DimList.create_unknown[rank]()</code>, meaning all dimension sizes are initially considered dynamic.</li> <li><code class="language-plaintext highlighter-rouge">strides: DimList</code>: Another <code class="language-plaintext highlighter-rouge">DimList</code>! This describes the <em>strides</em> of the buffer at compile time. Strides tell Mojo how many elements to “skip” in memory to move to the next element along a particular dimension. We’ll cover strides in detail in the next chapter. Like <code class="language-plaintext highlighter-rouge">shape</code>, it defaults to all dynamic.</li> <li><code class="language-plaintext highlighter-rouge">alignment: Int</code>: For performance, data in memory is sometimes “aligned” to start at addresses that are multiples of a certain number (e.g., 16 bytes, 64 bytes). This parameter specifies the desired alignment.</li> <li><code class="language-plaintext highlighter-rouge">address_space: AddressSpace</code>: Tells Mojo where the memory this <code class="language-plaintext highlighter-rouge">NDBuffer</code> describes is located (e.g., general CPU memory (<code class="language-plaintext highlighter-rouge">AddressSpace.GENERIC</code>), GPU shared memory, etc.).</li> <li><code class="language-plaintext highlighter-rouge">exclusive: Bool</code>: A more advanced flag. If <code class="language-plaintext highlighter-rouge">True</code>, it suggests that this <code class="language-plaintext highlighter-rouge">NDBuffer</code> (and its underlying pointer) is the <em>only</em> way the program is supposed to access this specific block of memory. This can enable certain optimizations.</li> </ul> <h3 id="core-internal-fields-runtime-information"> <a href="#core-internal-fields-runtime-information" class="anchor-heading" aria-labelledby="core-internal-fields-runtime-information"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Core Internal Fields (Runtime Information) </h3> <p>Inside every <code class="language-plaintext highlighter-rouge">NDBuffer</code> instance, there are a few crucial fields that store its runtime state:</p><pre><code class="language-mojo">// Inside the NDBuffer struct definition...
// ...
    var data: UnsafePointer[
        Scalar[type], // Points to elements of the NDBuffer's 'type'
        address_space=address_space, // Inherits from NDBuffer's parameter
        mut=mut, // Inherits from NDBuffer's parameter
        origin=origin // Inherits from NDBuffer's parameter
    ];

    // These store the *actual* runtime dimension sizes and strides
    var dynamic_shape: IndexList[rank, element_type = DType.uint64];
    var dynamic_stride: IndexList[rank, element_type = DType.uint64];
// ...
</code></pre><p>Let’s understand these:</p> <ol> <li><code class="language-plaintext highlighter-rouge">data: UnsafePointer[...]</code>: This is the direct link to the memory! It’s an <code class="language-plaintext highlighter-rouge">UnsafePointer</code> (from Chapter 1) that holds the memory address where the <em>first element</em> of the <code class="language-plaintext highlighter-rouge">NDBuffer</code>’s data begins. <ul> <li>Notice <code class="language-plaintext highlighter-rouge">Scalar[type]</code>: If <code class="language-plaintext highlighter-rouge">NDBuffer.type</code> is <code class="language-plaintext highlighter-rouge">DType.float32</code>, then <code class="language-plaintext highlighter-rouge">Scalar[type]</code> becomes <code class="language-plaintext highlighter-rouge">Float32</code>. The <code class="language-plaintext highlighter-rouge">UnsafePointer</code> points to individual elements of this type.</li> <li>Its <code class="language-plaintext highlighter-rouge">address_space</code>, <code class="language-plaintext highlighter-rouge">mut</code> (mutability), and <code class="language-plaintext highlighter-rouge">origin</code> are typically inherited from the <code class="language-plaintext highlighter-rouge">NDBuffer</code>’s own parameters.</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">dynamic_shape: IndexList[rank, ... ]</code>: This field holds the <em>actual, runtime</em> size of each of the <code class="language-plaintext highlighter-rouge">NDBuffer</code>’s <code class="language-plaintext highlighter-rouge">rank</code> dimensions. <ul> <li>An <code class="language-plaintext highlighter-rouge">IndexList</code> is a list of integers.</li> <li>Even if you provided static dimensions in the <code class="language-plaintext highlighter-rouge">shape: DimList</code> parameter (e.g., <code class="language-plaintext highlighter-rouge">DimList(Dim(3), Dim(4))</code>), those values get stored here (e.g., <code class="language-plaintext highlighter-rouge">IndexList(3, 4)</code>).</li> <li>If your <code class="language-plaintext highlighter-rouge">shape: DimList</code> had dynamic dimensions (e.g., <code class="language-plaintext highlighter-rouge">DimList(Dim(3), Dim())</code>), then <code class="language-plaintext highlighter-rouge">dynamic_shape</code> would be filled in when the <code class="language-plaintext highlighter-rouge">NDBuffer</code> is fully initialized with the actual runtime size for that dynamic dimension.</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">dynamic_stride: IndexList[rank, ... ]</code>: Similar to <code class="language-plaintext highlighter-rouge">dynamic_shape</code>, this field holds the <em>actual, runtime</em> stride for each dimension. Strides are crucial for navigating the N-dimensional data in the flat 1D memory. We’ll dedicate the next chapter to understanding them.</li> </ol> <p>So, the <code class="language-plaintext highlighter-rouge">NDBuffer</code> uses its <code class="language-plaintext highlighter-rouge">data</code> pointer to find the start of the memory, and then uses <code class="language-plaintext highlighter-rouge">dynamic_shape</code> and <code class="language-plaintext highlighter-rouge">dynamic_stride</code> to interpret that flat memory as a structured N-dimensional array.</p> <h2 id="bringing-it-all-together-initializing-an-ndbuffer"> <a href="#bringing-it-all-together-initializing-an-ndbuffer" class="anchor-heading" aria-labelledby="bringing-it-all-together-initializing-an-ndbuffer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bringing It All Together: Initializing an <code class="language-plaintext highlighter-rouge">NDBuffer</code> </h2> <p><code class="language-plaintext highlighter-rouge">NDBuffer</code> has many ways to be initialized (many <code class="language-plaintext highlighter-rouge">__init__</code> methods). We won’t cover them all, but let’s look at the general idea with a couple of simplified examples.</p> <p><strong>Example 1: A 2D <code class="language-plaintext highlighter-rouge">NDBuffer</code> with Statically Known Shape</strong></p> <p>Imagine you have an <code class="language-plaintext highlighter-rouge">UnsafePointer</code> called <code class="language-plaintext highlighter-rouge">my_ptr</code> that points to a block of <code class="language-plaintext highlighter-rouge">Float32</code> data in memory. You want to view this data as a 2x3 matrix (2 rows, 3 columns).</p><pre><code class="language-mojo">from memory import UnsafePointer, DType, Origin
from buffer import NDBuffer, DimList, Dim

fn main() raises:
    // Assume my_ptr is a valid UnsafePointer to enough Float32 data
    // For this example, we'll just create a dummy one.
    // In a real scenario, this memory would be allocated.
    var my_ptr = UnsafePointer[Float32](); // Dummy pointer

    // Define the NDBuffer's properties
    alias MyOrigin = Origin[True].init() // A dummy origin for the example

    // Create an NDBuffer for a 2x3 matrix of Float32s
    // NDBuffer[mut, type, rank, origin, shape_dimlist](pointer_to_data)
    let matrix_view = NDBuffer[
        True,                 // mut = True (mutable)
        DType.float32,        // type = DType.float32
        2,                    // rank = 2 (2D)
        MyOrigin,             // origin (memory tracking)
        DimList(Dim(2), Dim(3)) // shape = 2 rows, 3 columns (all static)
    ](my_ptr);

    // What happens inside matrix_view?
    // - matrix_view.data will hold my_ptr
    // - matrix_view.dynamic_shape will be an IndexList like (2, 3)
    // - matrix_view.dynamic_stride will be calculated for a contiguous 2x3 layout
    //   (e.g., (3, 1) meaning jump 3 elements for next row, 1 for next column)
    print(matrix_view.get_shape())
</code></pre><p><em>Output (conceptual, depends on actual initialization context for dummy pointer)</em>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(2, 3)
</code></pre></div></div> <p>In this case, because the shape <code class="language-plaintext highlighter-rouge">DimList(Dim(2), Dim(3))</code> is fully static, Mojo knows the exact dimensions at compile time. The <code class="language-plaintext highlighter-rouge">NDBuffer</code> then stores this pointer and shape information. It also computes default strides assuming the data is laid out contiguously (like words in a book, one row after another).</p> <p><strong>Example 2: A 1D <code class="language-plaintext highlighter-rouge">NDBuffer</code> with Dynamically Known Shape</strong></p> <p>Now, let’s say <code class="language-plaintext highlighter-rouge">my_ptr</code> points to <code class="language-plaintext highlighter-rouge">Int</code> data, but the number of integers isn’t known until runtime.</p><pre><code class="language-mojo">from memory import UnsafePointer, DType, Origin, IndexList
from buffer import NDBuffer, DimList

fn main() raises:
    var my_ptr = UnsafePointer[Int](); // Dummy pointer
    alias MyOrigin = Origin[True].init()

    let num_elements_runtime: Int = 10; // Determined at runtime

    // Create an NDBuffer for a 1D array.
    // The shape DimList parameter defaults to DimList.create_unknown[rank](),
    // so we pass the dynamic shape directly.
    // NDBuffer[mut, type, rank, origin](pointer_to_data, dynamic_shape_indexlist)
    let vector_view = NDBuffer[
        True,          // mut
        DType.int64,   // type
        1,             // rank = 1 (1D)
        MyOrigin       // origin
    ](my_ptr, IndexList[1](num_elements_runtime));

    // Inside vector_view:
    // - vector_view.data holds my_ptr
    // - vector_view.dynamic_shape will be an IndexList like (10)
    // - vector_view.dynamic_stride will be (1) for a contiguous 1D array.
    print(vector_view.get_shape())
</code></pre><p><em>Output (conceptual)</em>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(10)
</code></pre></div></div> <p>Here, the <code class="language-plaintext highlighter-rouge">NDBuffer</code> is initialized with <code class="language-plaintext highlighter-rouge">my_ptr</code> and an <code class="language-plaintext highlighter-rouge">IndexList</code> containing the runtime size <code class="language-plaintext highlighter-rouge">num_elements_runtime</code>. The <code class="language-plaintext highlighter-rouge">dynamic_shape</code> field inside <code class="language-plaintext highlighter-rouge">vector_view</code> will store this runtime size.</p> <p>These examples show the core idea: <code class="language-plaintext highlighter-rouge">NDBuffer</code> combines a pointer to raw memory (<code class="language-plaintext highlighter-rouge">data</code>) with descriptions of its structure (<code class="language-plaintext highlighter-rouge">dynamic_shape</code>, <code class="language-plaintext highlighter-rouge">dynamic_stride</code>) to provide a meaningful N-dimensional view.</p> <h2 id="what-can-you-do-with-an-ndbuffer-a-sneak-peek"> <a href="#what-can-you-do-with-an-ndbuffer-a-sneak-peek" class="anchor-heading" aria-labelledby="what-can-you-do-with-an-ndbuffer-a-sneak-peek"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What Can You Do With an <code class="language-plaintext highlighter-rouge">NDBuffer</code>? (A Sneak Peek) </h2> <p>Once you have an <code class="language-plaintext highlighter-rouge">NDBuffer</code>, you can perform many operations, such as:</p> <ul> <li><strong>Get its rank</strong>: <code class="language-plaintext highlighter-rouge">let r = my_ndbuffer.get_rank()</code></li> <li><strong>Get its shape (runtime)</strong>: <code class="language-plaintext highlighter-rouge">let s = my_ndbuffer.get_shape()</code> (returns an <code class="language-plaintext highlighter-rouge">IndexList</code>)</li> <li><strong>Get its strides (runtime)</strong>: <code class="language-plaintext highlighter-rouge">let st = my_ndbuffer.get_strides()</code> (returns an <code class="language-plaintext highlighter-rouge">IndexList</code>)</li> <li><strong>Get the total number of elements</strong>: <code class="language-plaintext highlighter-rouge">let count = my_ndbuffer.num_elements()</code> or <code class="language-plaintext highlighter-rouge">len(my_ndbuffer)</code></li> <li><strong>Access an element</strong>: <code class="language-plaintext highlighter-rouge">let element = my_ndbuffer[idx0, idx1, ...]</code> (e.g., <code class="language-plaintext highlighter-rouge">matrix_view[0, 1]</code> for row 0, col 1). This is done via the <code class="language-plaintext highlighter-rouge">__getitem__</code> method.</li> <li><strong>Set an element (if mutable)</strong>: <code class="language-plaintext highlighter-rouge">my_ndbuffer[idx0, idx1, ...] = new_value</code>. This is done via the <code class="language-plaintext highlighter-rouge">__setitem__</code> method.</li> <li><strong>Load/Store SIMD vectors</strong>: For performance, you can load or store multiple elements at once using SIMD operations (e.g., <code class="language-plaintext highlighter-rouge">my_ndbuffer.load[width=4](...)</code>).</li> </ul> <p>We’ll explore these operations, especially element access and the role of strides, in more detail in upcoming chapters.</p> <h2 id="key-takeaways-for-chapter-3"> <a href="#key-takeaways-for-chapter-3" class="anchor-heading" aria-labelledby="key-takeaways-for-chapter-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Takeaways for Chapter 3 </h2> <ul> <li><code class="language-plaintext highlighter-rouge">NDBuffer</code> is a <strong>non-owning view</strong> or “lens” that interprets a block of memory as an N-dimensional array.</li> <li>It combines an <code class="language-plaintext highlighter-rouge">UnsafePointer</code> (to the start of the data) with shape and stride information.</li> <li><strong>Key Parameters</strong> (compile-time info): <code class="language-plaintext highlighter-rouge">mut</code>, <code class="language-plaintext highlighter-rouge">type</code>, <code class="language-plaintext highlighter-rouge">rank</code>, <code class="language-plaintext highlighter-rouge">origin</code>, <code class="language-plaintext highlighter-rouge">shape: DimList</code>, <code class="language-plaintext highlighter-rouge">strides: DimList</code>, <code class="language-plaintext highlighter-rouge">alignment</code>, <code class="language-plaintext highlighter-rouge">address_space</code>.</li> <li><strong>Core Internal Fields</strong> (runtime info): <code class="language-plaintext highlighter-rouge">data: UnsafePointer</code>, <code class="language-plaintext highlighter-rouge">dynamic_shape: IndexList</code>, <code class="language-plaintext highlighter-rouge">dynamic_stride: IndexList</code>.</li> <li>The <code class="language-plaintext highlighter-rouge">shape: DimList</code> parameter allows specifying static or dynamic dimension sizes at compile time, while <code class="language-plaintext highlighter-rouge">dynamic_shape: IndexList</code> stores the actual runtime sizes.</li> <li><code class="language-plaintext highlighter-rouge">NDBuffer</code> enables Mojo to handle multi-dimensional data flexibly and efficiently.</li> </ul> <h2 id="whats-next"> <a href="#whats-next" class="anchor-heading" aria-labelledby="whats-next"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What’s Next? </h2> <p>We’ve seen that <code class="language-plaintext highlighter-rouge">NDBuffer</code> uses <code class="language-plaintext highlighter-rouge">data</code>, <code class="language-plaintext highlighter-rouge">dynamic_shape</code>, and <code class="language-plaintext highlighter-rouge">dynamic_stride</code> to make sense of memory. But how exactly does it use <code class="language-plaintext highlighter-rouge">dynamic_stride</code> to find, for example, the element at <code class="language-plaintext highlighter-rouge">[row_index, column_index]</code> in a 2D matrix? This involves understanding <strong>strides</strong> and <strong>offset computation</strong>. That’s precisely what we’ll unravel in <a href="04_strides_and_offset_computation_.md">Chapter 4: Strides and Offset Computation</a>!</p><hr /> <p><em>Navigation</em></p> <ol> <li><a href="01_unsafepointer__as_used_by_ndbuffer__.md">UnsafePointer (as used by NDBuffer)</a></li> <li><a href="02_dimlist_and_dim_.md">DimList and Dim</a></li> <li><strong>NDBuffer (You are here)</strong></li> <li><a href="04_strides_and_offset_computation_.md">Strides and Offset Computation</a></li> <li><a href="05_simd_data_access_.md">SIMD Data Access</a> ```</li> </ol><hr /> <p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p> </main> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
