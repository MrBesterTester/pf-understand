<h1 id="chapter-8-agentlogger--monitor---observing-your-agent-in-action">Chapter 8: AgentLogger &amp; Monitor - Observing Your Agent in Action</h1>

<p>Welcome to the final chapter of the SmolaAgents tutorial! In <a href="07_agenttype.md">Chapter 7: AgentType</a>, we saw how <code class="language-plaintext highlighter-rouge">SmolaAgents</code> handles different kinds of data like text, images, and audio using specialized containers. Now that our agent can perform complex tasks (<a href="01_multistepagent.md">Chapter 1: MultiStepAgent</a>), use various <a href="03_tool.md">Tools</a>, remember its progress (<a href="04_agentmemory.md">Chapter 4: AgentMemory</a>), and even handle diverse data types, a new question arises: <strong>How do we actually see what the agent is doing?</strong></p>

<p>What if the agent gets stuck in a loop? What if it uses the wrong tool or gives an unexpected answer? How can we peek inside its “mind” to understand its reasoning, track its actions, and maybe figure out what went wrong or how well it’s performing?</p>

<h2 id="the-problem-flying-blind">The Problem: Flying Blind</h2>

<p>Imagine driving a car with no dashboard. You wouldn’t know your speed, fuel level, or if the engine was overheating. You’d be driving blind! Or imagine an airplane without its “black box” flight recorder – after an incident, it would be much harder to understand what happened.</p>

<p><img src="https://img.icons8.com/ios/50/000000/car--v1.png" alt="Car with no dashboard" /> ❓❓❓</p>

<p>Running an AI agent without visibility is similar. Without seeing its internal steps, thoughts, and actions, debugging problems or understanding its behavior becomes incredibly difficult. We need a way to observe the agent in real-time and record its performance.</p>

<h2 id="the-solution-the-dashboard-agentlogger-and-black-box-monitor">The Solution: The Dashboard (<code class="language-plaintext highlighter-rouge">AgentLogger</code>) and Black Box (<code class="language-plaintext highlighter-rouge">Monitor</code>)</h2>

<p><code class="language-plaintext highlighter-rouge">SmolaAgents</code> provides two key components to give you this visibility:</p>

<ol>
  <li><strong><code class="language-plaintext highlighter-rouge">AgentLogger</code> (The Dashboard):</strong> This component provides <strong>structured, real-time logging</strong> of the agent’s activities directly to your console (or wherever you run your Python script). It uses a library called <code class="language-plaintext highlighter-rouge">rich</code> to display colorful, formatted output, making it easy to follow:
    <ul>
      <li>Which step the agent is on.</li>
      <li>The LLM’s thoughts and the action it plans to take.</li>
      <li>Which <a href="03_tool.md">Tool</a> is being called and with what arguments.</li>
      <li>The results (observations) from the tool.</li>
      <li>Any errors encountered.
It’s like watching the car’s speedometer, fuel gauge, and warning lights as you drive.</li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">Monitor</code> (The Black Box):</strong> This component works quietly in the background, <strong>tracking key performance metrics</strong> during the agent’s run. It records data like:
    <ul>
      <li>How long each step took (duration).</li>
      <li>How many tokens the LLM used for input and output (if the <a href="02_model_interface.md">Model Interface</a> provides this).
This data isn’t usually displayed as prominently as the logger’s output but is stored and can be used later for analysis, cost calculation, or identifying performance bottlenecks. It’s like the airplane’s flight data recorder.</li>
    </ul>
  </li>
</ol>

<p>Both <code class="language-plaintext highlighter-rouge">AgentLogger</code> and <code class="language-plaintext highlighter-rouge">Monitor</code> are automatically set up and used by the <code class="language-plaintext highlighter-rouge">MultiStepAgent</code>, making observation easy!</p>

<h2 id="agentlogger-your-real-time-dashboard"><code class="language-plaintext highlighter-rouge">AgentLogger</code>: Your Real-Time Dashboard</h2>

<p>The <code class="language-plaintext highlighter-rouge">AgentLogger</code> is your primary window into the agent’s live execution. It makes the <strong>Think -&gt; Act -&gt; Observe</strong> cycle visible.</p>

<p><strong>How It’s Used (Automatic!)</strong></p>

<p>When you create a <code class="language-plaintext highlighter-rouge">MultiStepAgent</code>, it automatically creates an <code class="language-plaintext highlighter-rouge">AgentLogger</code> instance, usually stored in <code class="language-plaintext highlighter-rouge">self.logger</code>. Throughout the agent’s <code class="language-plaintext highlighter-rouge">run</code> process, various methods within the agent call <code class="language-plaintext highlighter-rouge">self.logger</code> to print information:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">agent.run()</code> calls <code class="language-plaintext highlighter-rouge">self.logger.log_task()</code> to show the initial task.</li>
  <li><code class="language-plaintext highlighter-rouge">agent._execute_step()</code> calls <code class="language-plaintext highlighter-rouge">self.logger.log_rule()</code> to mark the beginning of a new step.</li>
  <li>If the agent uses code (like <code class="language-plaintext highlighter-rouge">CodeAgent</code>), it calls <code class="language-plaintext highlighter-rouge">self.logger.log_code()</code> to show the code being executed.</li>
  <li>It logs tool calls using <code class="language-plaintext highlighter-rouge">self.logger.log()</code>.</li>
  <li>It logs observations using <code class="language-plaintext highlighter-rouge">self.logger.log()</code>.</li>
  <li>It logs errors using <code class="language-plaintext highlighter-rouge">self.logger.log_error()</code>.</li>
  <li>It logs the final answer using <code class="language-plaintext highlighter-rouge">self.logger.log()</code>.</li>
</ul>

<p><strong>Example Output (Simulated)</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">AgentLogger</code> uses <code class="language-plaintext highlighter-rouge">rich</code> to make the output colorful and easy to read. Here’s a simplified idea of what you might see in your console for our “Capital and Weather” example:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">╭─[bold] New run ─ ToolCallingAgent [/bold]────────────────────────────────╮
│                                                                       │
│ [bold]What is the capital of France, and what is its current weather?[/bold] │
│                                                                       │
╰────────────────────────── LiteLLMModel - gpt-3.5-turbo ─╯

━━━[bold] Step 1 [/bold]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
INFO     ╭─ Thinking... ───────────────────────────────────────────────────╮
INFO     │ Thought: The user wants the capital of France and its weather.│
INFO     │ First, I need to find the capital. I can use the search tool. │
INFO     ╰─────────────────────────────────────────────────────────────────╯
INFO     Panel(Text("Calling tool: 'search' with arguments: {'query': 'Capital of France'}"))
INFO     Observations: Paris
DEBUG    [Step 1: Duration 1.52 seconds| Input tokens: 150 | Output tokens: 50]

━━━[bold] Step 2 [/bold]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
INFO     ╭─ Thinking... ───────────────────────────────────────────────────╮
INFO     │ Thought: I have the capital, which is Paris. Now I need the   │
INFO     │ weather for Paris. I can use the weather tool.                │
INFO     ╰─────────────────────────────────────────────────────────────────╯
INFO     Panel(Text("Calling tool: 'weather' with arguments: {'location': 'Paris'}"))
INFO     Observations: Sunny, 25°C
DEBUG    [Step 2: Duration 1.81 seconds| Input tokens: 210 | Output tokens: 105]

━━━[bold] Step 3 [/bold]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
INFO     ╭─ Thinking... ───────────────────────────────────────────────────╮
INFO     │ Thought: I have both the capital (Paris) and the weather      │
INFO     │ (Sunny, 25°C). I have fulfilled the user's request. I should  │
INFO     │ use the final_answer tool.                                    │
INFO     ╰─────────────────────────────────────────────────────────────────╯
INFO     Panel(Text("Calling tool: 'final_answer' with arguments: {'answer': 'The capital of France is Paris, and the current weather there is Sunny, 25°C.'}"))
</span><span class="gp">INFO     [bold #</span>d4b702]Final answer:[/bold <span class="c">#d4b702] The capital of France is Paris, and the current weather there is Sunny, 25°C.</span>
<span class="go">DEBUG    [Step 3: Duration 1.25 seconds| Input tokens: 280 | Output tokens: 170]
</span></code></pre></div></div>

<p><em>(Note: This is a conceptual representation. The exact formatting, colors, and details might vary. The “Thinking…” part is simulated; the logger typically shows the raw model output or parsed action.)</em></p>

<p><strong>Log Levels</strong></p>

<p>You can control how much detail the logger shows using the <code class="language-plaintext highlighter-rouge">verbosity_level</code> parameter when creating the agent:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">LogLevel.INFO</code> (Default): Shows the main steps, tool calls, observations, final answer, and errors. Good for general use.</li>
  <li><code class="language-plaintext highlighter-rouge">LogLevel.DEBUG</code>: Shows everything <code class="language-plaintext highlighter-rouge">INFO</code> shows, plus the detailed LLM inputs/outputs and performance metrics from the <code class="language-plaintext highlighter-rouge">Monitor</code>. Useful for deep debugging.</li>
  <li><code class="language-plaintext highlighter-rouge">LogLevel.ERROR</code>: Only shows critical error messages.</li>
  <li><code class="language-plaintext highlighter-rouge">LogLevel.OFF</code>: Shows nothing.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">smolagents</span> <span class="kn">import</span> <span class="n">CodeAgent</span>
<span class="kn">from</span> <span class="nn">smolagents.models</span> <span class="kn">import</span> <span class="n">LiteLLMModel</span>
<span class="kn">from</span> <span class="nn">smolagents.monitoring</span> <span class="kn">import</span> <span class="n">LogLevel</span> <span class="c1"># Import LogLevel
</span>
<span class="n">llm</span> <span class="o">=</span> <span class="n">LiteLLMModel</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="s">"gpt-3.5-turbo"</span><span class="p">)</span>

<span class="c1"># Create an agent with DEBUG level logging
</span><span class="n">agent_debug</span> <span class="o">=</span> <span class="n">CodeAgent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">verbosity_level</span><span class="o">=</span><span class="n">LogLevel</span><span class="p">.</span><span class="n">DEBUG</span> <span class="c1"># Set the level here
</span><span class="p">)</span>

<span class="c1"># This agent will print more detailed logs when run
# agent_debug.run("What is 2+2?")
</span></code></pre></div></div>

<p><strong>Code Glimpse (<code class="language-plaintext highlighter-rouge">monitoring.py</code> and <code class="language-plaintext highlighter-rouge">agents.py</code>)</strong></p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">AgentLogger</code> Class:</strong> It uses the <code class="language-plaintext highlighter-rouge">rich.console.Console</code> to print formatted output based on the log level.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># --- File: monitoring.py (Simplified AgentLogger) ---
</span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">IntEnum</span>
<span class="kn">from</span> <span class="nn">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span> <span class="nn">rich.panel</span> <span class="kn">import</span> <span class="n">Panel</span>
<span class="kn">from</span> <span class="nn">rich.syntax</span> <span class="kn">import</span> <span class="n">Syntax</span>
<span class="kn">from</span> <span class="nn">rich.rule</span> <span class="kn">import</span> <span class="n">Rule</span>
<span class="c1"># ... other rich imports ...
</span>
<span class="k">class</span> <span class="nc">LogLevel</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">OFF</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">ERROR</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">INFO</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">YELLOW_HEX</span> <span class="o">=</span> <span class="s">"#d4b702"</span> <span class="c1"># Used for styling
</span>
<span class="k">class</span> <span class="nc">AgentLogger</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="c1"># The core object from the 'rich' library for printing
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Logs a message if the level is sufficient."""</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="p">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">console</span><span class="p">.</span><span class="k">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="s">"""Logs an error message."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">"bold red"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">LogLevel</span><span class="p">.</span><span class="n">ERROR</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">):</span>
        <span class="s">"""Logs a Python code block with syntax highlighting."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">Panel</span><span class="p">(</span><span class="n">Syntax</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="s">"python"</span><span class="p">,</span> <span class="p">...),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="p">...),</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">):</span>
        <span class="s">"""Logs a horizontal rule separator."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rule</span><span class="p">(</span><span class="s">"[bold]"</span> <span class="o">+</span> <span class="n">title</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">YELLOW_HEX</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">subtitle</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">):</span>
         <span class="s">"""Logs the initial task."""</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">Panel</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="s">[bold]</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">subtitle</span><span class="o">=</span><span class="n">subtitle</span><span class="p">,</span> <span class="p">...),</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>

    <span class="c1"># ... other helper methods for specific formatting ...
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Agent Using the Logger:</strong> The <code class="language-plaintext highlighter-rouge">MultiStepAgent</code> calls <code class="language-plaintext highlighter-rouge">self.logger</code> methods.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># --- File: agents.py (Simplified Agent using Logger) ---
</span><span class="kn">from</span> <span class="nn">.monitoring</span> <span class="kn">import</span> <span class="n">AgentLogger</span><span class="p">,</span> <span class="n">LogLevel</span>

<span class="k">class</span> <span class="nc">MultiStepAgent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">...,</span> <span class="n">verbosity_level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">):</span>
        <span class="c1"># ... other setup ...
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">AgentLogger</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">verbosity_level</span><span class="p">)</span>
        <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="p">...):</span>
        <span class="c1"># ...
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">log_task</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">task</span><span class="p">,</span> <span class="p">...,</span> <span class="n">level</span><span class="o">=</span><span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="c1"># ... call _run ...
</span>
    <span class="k">def</span> <span class="nf">_execute_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_step</span><span class="p">:</span> <span class="n">ActionStep</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">log_rule</span><span class="p">(</span><span class="sa">f</span><span class="s">"Step </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">step_number</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ... (Think phase: LLM call) ...
</span>
            <span class="c1"># ... (Act phase: Execute tool/code) ...
</span>            <span class="c1"># Example for CodeAgent:
</span>            <span class="c1"># self.logger.log_code("Executing code:", code_action, level=LogLevel.INFO)
</span>            <span class="c1"># observation = self.python_executor(code_action)
</span>
            <span class="c1"># Example for ToolCallingAgent:
</span>            <span class="c1"># self.logger.log(Panel(f"Calling tool: '{tool_name}' ..."), level=LogLevel.INFO)
</span>            <span class="c1"># observation = self.execute_tool_call(tool_name, arguments)
</span>
            <span class="c1"># ... (Observe phase) ...
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s">"Observations: </span><span class="si">{</span><span class="n">observation</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">LogLevel</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>

            <span class="c1"># ... (Handle final answer) ...
</span>            <span class="c1"># if final_answer:
</span>            <span class="c1">#    self.logger.log(f"Final answer: {final_answer}", style=f"bold {YELLOW_HEX}", level=LogLevel.INFO)
</span>
        <span class="k">except</span> <span class="n">AgentError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Log errors using the logger's error method
</span>            <span class="n">action_step</span><span class="p">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">e</span> <span class="c1"># Store error in memory
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">log_error</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error in step </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">step_number</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span> <span class="c1"># Display error
</span>
        <span class="c1"># ...
</span></code></pre></div>    </div>
  </li>
</ul>

<h2 id="monitor-your-performance-black-box"><code class="language-plaintext highlighter-rouge">Monitor</code>: Your Performance Black Box</h2>

<p>While the <code class="language-plaintext highlighter-rouge">AgentLogger</code> shows you <em>what</em> the agent is doing, the <code class="language-plaintext highlighter-rouge">Monitor</code> tracks <em>how well</em> it’s doing it in terms of performance.</p>

<p><strong>How It’s Used (Automatic!)</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">MultiStepAgent</code> also creates a <code class="language-plaintext highlighter-rouge">Monitor</code> instance (<code class="language-plaintext highlighter-rouge">self.monitor</code>). The monitor’s main job is done via its <code class="language-plaintext highlighter-rouge">update_metrics</code> method. This method is automatically added to a list of <code class="language-plaintext highlighter-rouge">step_callbacks</code> in the agent. At the end of every single step, the agent calls all functions in <code class="language-plaintext highlighter-rouge">step_callbacks</code>, including <code class="language-plaintext highlighter-rouge">self.monitor.update_metrics</code>.</p>

<p>Inside <code class="language-plaintext highlighter-rouge">update_metrics</code>, the monitor:</p>
<ol>
  <li>Accesses the <code class="language-plaintext highlighter-rouge">ActionStep</code> object for the just-completed step from <a href="04_agentmemory.md">AgentMemory</a>.</li>
  <li>Reads the <code class="language-plaintext highlighter-rouge">duration</code> recorded in the <code class="language-plaintext highlighter-rouge">ActionStep</code>.</li>
  <li>Accesses the agent’s <a href="02_model_interface.md">Model Interface</a> (<code class="language-plaintext highlighter-rouge">self.tracked_model</code>) to get the token counts (<code class="language-plaintext highlighter-rouge">last_input_token_count</code>, <code class="language-plaintext highlighter-rouge">last_output_token_count</code>) for the LLM call made during that step (if available).</li>
  <li>Updates its internal totals (e.g., <code class="language-plaintext highlighter-rouge">total_input_token_count</code>).</li>
  <li>Uses the <code class="language-plaintext highlighter-rouge">AgentLogger</code> (passed during initialization) to print these metrics, but typically only at the <code class="language-plaintext highlighter-rouge">DEBUG</code> log level, so they don’t clutter the default <code class="language-plaintext highlighter-rouge">INFO</code> output.</li>
</ol>

<p><strong>Example Output (at <code class="language-plaintext highlighter-rouge">DEBUG</code> level)</strong></p>

<p>If you run the agent with <code class="language-plaintext highlighter-rouge">verbosity_level=LogLevel.DEBUG</code>, you’ll see the monitor’s output added at the end of each step log:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">[...]
INFO     Observations: Paris
</span><span class="gp">DEBUG    [Step 1: Duration 1.52 seconds| Input tokens: 150 | Output tokens: 50]  #</span><span class="w"> </span>&lt;<span class="nt">--</span> Monitor Output
<span class="go">
[...]
INFO     Observations: Sunny, 25°C
</span><span class="gp">DEBUG    [Step 2: Duration 1.81 seconds| Input tokens: 210 | Output tokens: 105] #</span><span class="w"> </span>&lt;<span class="nt">--</span> Monitor Output
<span class="go">
[...]
</span><span class="gp">INFO     [bold #</span>d4b702]Final answer:[/bold <span class="c">#d4b702] The capital of France is Paris, ...</span>
<span class="gp">DEBUG    [Step 3: Duration 1.25 seconds| Input tokens: 280 | Output tokens: 170] #</span><span class="w"> </span>&lt;<span class="nt">--</span> Monitor Output
</code></pre></div></div>

<p><strong>Code Glimpse (<code class="language-plaintext highlighter-rouge">monitoring.py</code> and <code class="language-plaintext highlighter-rouge">agents.py</code>)</strong></p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">Monitor</code> Class:</strong> Tracks metrics and logs them.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># --- File: monitoring.py (Simplified Monitor) ---
</span><span class="kn">from</span> <span class="nn">.memory</span> <span class="kn">import</span> <span class="n">ActionStep</span> <span class="c1"># Needs access to step data
</span><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Model</span> <span class="c1"># Needs access to model token counts
</span><span class="kn">from</span> <span class="nn">.monitoring</span> <span class="kn">import</span> <span class="n">AgentLogger</span><span class="p">,</span> <span class="n">LogLevel</span> <span class="c1"># Uses the logger to print
</span>
<span class="k">class</span> <span class="nc">Monitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tracked_model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">AgentLogger</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">step_durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tracked_model</span> <span class="o">=</span> <span class="n">tracked_model</span> <span class="c1"># Reference to the agent's model
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="c1"># Uses the logger to output metrics
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">total_input_token_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">total_output_token_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># ... potentially other metrics ...
</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Resets metrics for a new run."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">step_durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">total_input_token_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">total_output_token_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">update_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_log</span><span class="p">:</span> <span class="n">ActionStep</span><span class="p">):</span>
        <span class="s">"""Callback function called after each step."""</span>
        <span class="c1"># 1. Get duration from the step log
</span>        <span class="n">step_duration</span> <span class="o">=</span> <span class="n">step_log</span><span class="p">.</span><span class="n">duration</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">step_durations</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">step_duration</span><span class="p">)</span>

        <span class="n">console_outputs</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"[Step </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">step_durations</span><span class="p">)</span><span class="si">}</span><span class="s">: Duration </span><span class="si">{</span><span class="n">step_duration</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span>

        <span class="c1"># 2. Get token counts from the model (if available)
</span>        <span class="n">input_tokens</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tracked_model</span><span class="p">,</span> <span class="s">"last_input_token_count"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">output_tokens</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tracked_model</span><span class="p">,</span> <span class="s">"last_output_token_count"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">input_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">output_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">total_input_token_count</span> <span class="o">+=</span> <span class="n">input_tokens</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">total_output_token_count</span> <span class="o">+=</span> <span class="n">output_tokens</span>
            <span class="c1"># 4. Format metrics string
</span>            <span class="n">console_outputs</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s">"| Input tokens: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">total_input_token_count</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="s">"</span>
                <span class="sa">f</span><span class="s">" | Output tokens: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">total_output_token_count</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="s">"</span>
            <span class="p">)</span>
        <span class="n">console_outputs</span> <span class="o">+=</span> <span class="s">"]"</span>

        <span class="c1"># 5. Log metrics using the logger (at DEBUG level)
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">console_outputs</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">LogLevel</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span> <span class="c1"># Note: logs at DEBUG
</span>
    <span class="c1"># ... methods to get totals, averages etc. ...
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Agent Setting Up the Monitor:</strong></p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># --- File: agents.py (Simplified Agent setup for Monitor) ---
</span><span class="kn">from</span> <span class="nn">.monitoring</span> <span class="kn">import</span> <span class="n">Monitor</span>
<span class="kn">from</span> <span class="nn">.memory</span> <span class="kn">import</span> <span class="n">ActionStep</span>

<span class="k">class</span> <span class="nc">MultiStepAgent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">...,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">step_callbacks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="c1"># ... setup logger ...
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="c1"># Store the model
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="n">Monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">logger</span><span class="p">)</span> <span class="c1"># Create Monitor
</span>
        <span class="c1"># Add monitor's update method to callbacks
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">step_callbacks</span> <span class="o">=</span> <span class="n">step_callbacks</span> <span class="k">if</span> <span class="n">step_callbacks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">step_callbacks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">monitor</span><span class="p">.</span><span class="n">update_metrics</span><span class="p">)</span>
        <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">_finalize_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_step</span><span class="p">:</span> <span class="n">ActionStep</span><span class="p">,</span> <span class="n">step_start_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="s">"""Called at the very end of each step."""</span>
        <span class="n">memory_step</span><span class="p">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">memory_step</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">memory_step</span><span class="p">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">step_start_time</span>

        <span class="c1"># Call all registered callbacks, including monitor.update_metrics
</span>        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">step_callbacks</span><span class="p">:</span>
             <span class="c1"># Pass the completed step data to the callback
</span>             <span class="n">callback</span><span class="p">(</span><span class="n">memory_step</span><span class="p">)</span>
        <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">...,</span> <span class="n">reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
         <span class="c1"># ...
</span>         <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
             <span class="bp">self</span><span class="p">.</span><span class="n">memory</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>
             <span class="bp">self</span><span class="p">.</span><span class="n">monitor</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span> <span class="c1"># Reset monitor metrics on new run
</span>         <span class="c1"># ...
</span></code></pre></div>    </div>
  </li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>The <code class="language-plaintext highlighter-rouge">AgentLogger</code> and <code class="language-plaintext highlighter-rouge">Monitor</code> are your essential tools for observing and understanding your <code class="language-plaintext highlighter-rouge">SmolaAgents</code>.</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">AgentLogger</code></strong> acts as the real-time dashboard, giving you formatted, colorful console output of the agent’s steps, thoughts, actions, and errors, crucial for debugging and following along.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">Monitor</code></strong> acts as the performance black box, tracking metrics like step duration and token usage, which are logged (usually at the <code class="language-plaintext highlighter-rouge">DEBUG</code> level) and useful for analysis and optimization.</li>
</ul>

<p>You’ve learned:</p>

<ul>
  <li>Why visibility into agent execution is critical.</li>
  <li>The roles of <code class="language-plaintext highlighter-rouge">AgentLogger</code> (dashboard) and <code class="language-plaintext highlighter-rouge">Monitor</code> (black box).</li>
  <li>How they are automatically used by <code class="language-plaintext highlighter-rouge">MultiStepAgent</code>.</li>
  <li>How <code class="language-plaintext highlighter-rouge">AgentLogger</code> provides readable, step-by-step output using <code class="language-plaintext highlighter-rouge">rich</code>.</li>
  <li>How <code class="language-plaintext highlighter-rouge">Monitor</code> tracks performance metrics via step callbacks.</li>
  <li>How to control log verbosity using <code class="language-plaintext highlighter-rouge">LogLevel</code>.</li>
</ul>

<p>With these tools, you’re no longer flying blind! You can confidently run your agents, watch them work, understand their performance, and diagnose issues when they arise.</p>

<p>This concludes our introductory tour of the core concepts in <code class="language-plaintext highlighter-rouge">SmolaAgents</code>. We hope these chapters have given you a solid foundation to start building your own intelligent agents. Happy coding!</p>

<hr />

<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>
