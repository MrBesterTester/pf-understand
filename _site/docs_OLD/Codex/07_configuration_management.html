<h1 id="chapter-7-configuration-management">Chapter 7: Configuration Management</h1>

<p>In the <a href="06_command_execution___sandboxing.md">previous chapter</a>, we saw how Codex carefully executes commands, using sandboxing for safety when needed. But how does Codex remember your preferences between sessions? For instance, how does it know which AI model you like to use, or whether you prefer <code class="language-plaintext highlighter-rouge">auto-edit</code> mode? And how can you give Codex persistent instructions about how you want it to behave?</p>

<p>This is where <strong>Configuration Management</strong> comes in. Think of it like the settings menu or preferences file for Codex.</p>

<h2 id="whats-the-big-idea-remembering-your-settings">Whatâ€™s the Big Idea? Remembering Your Settings</h2>

<p>Imagine you prefer using the powerful <code class="language-plaintext highlighter-rouge">gpt-4o</code> model instead of the default <code class="language-plaintext highlighter-rouge">o4-mini</code>. Or perhaps you always want Codex to follow a specific coding style or avoid using certain commands unless you explicitly ask. It would be annoying to tell Codex this <em>every single time</em> you run it using command-line flags like <code class="language-plaintext highlighter-rouge">--model gpt-4o</code>.</p>

<p>Configuration Management solves this by allowing Codex to:</p>

<ol>
  <li><strong>Load Default Settings:</strong> Read a special file to know your preferred model, default <a href="04_approval_policy___security.md">Approval Policy</a> mode, etc.</li>
  <li><strong>Load Custom Instructions:</strong> Read other special files containing your personal guidelines or project-specific rules for the AI.</li>
</ol>

<p>This way, Codex behaves consistently according to your setup without needing constant reminders. Itâ€™s like setting up your favorite text editor with your preferred theme and plugins â€“ you do it once, and it remembers.</p>

<h2 id="key-concepts">Key Concepts</h2>

<ol>
  <li><strong>Configuration File (<code class="language-plaintext highlighter-rouge">config.yaml</code>)</strong>:
    <ul>
      <li><strong>Where:</strong> Lives in your home directory, inside a hidden folder: <code class="language-plaintext highlighter-rouge">~/.codex/config.yaml</code> (it might also be <code class="language-plaintext highlighter-rouge">.json</code> or <code class="language-plaintext highlighter-rouge">.yml</code>).</li>
      <li><strong>What:</strong> Stores your default settings. The most common setting is the AI <code class="language-plaintext highlighter-rouge">model</code> you want Codex to use. You can also set things like the default error handling behavior in <code class="language-plaintext highlighter-rouge">full-auto</code> mode (<code class="language-plaintext highlighter-rouge">fullAutoErrorMode</code>).</li>
      <li><strong>Format:</strong> Usually written in YAML (or JSON), which is a simple, human-readable format.</li>
    </ul>
  </li>
  <li><strong>Instruction Files (<code class="language-plaintext highlighter-rouge">instructions.md</code>, <code class="language-plaintext highlighter-rouge">codex.md</code>)</strong>:
    <ul>
      <li><strong>Where:</strong>
        <ul>
          <li><strong>Global:</strong> <code class="language-plaintext highlighter-rouge">~/.codex/instructions.md</code> - These instructions apply every time you run Codex, anywhere on your system.</li>
          <li><strong>Project-Specific:</strong> <code class="language-plaintext highlighter-rouge">codex.md</code> (or <code class="language-plaintext highlighter-rouge">.codex.md</code>) - Placed in the root directory of your code project (or sometimes in subdirectories). These instructions apply only when you run Codex within that specific project.</li>
        </ul>
      </li>
      <li><strong>What:</strong> Contain text instructions (written in Markdown) that guide the AIâ€™s behavior. Think of it as giving your AI assistant standing orders.</li>
      <li><strong>Format:</strong> Plain Markdown text.</li>
    </ul>
  </li>
  <li><strong>Loading Order:</strong> Codex combines these instructions intelligently:
    <ul>
      <li>It first reads the global instructions (<code class="language-plaintext highlighter-rouge">~/.codex/instructions.md</code>).</li>
      <li>Then, if it finds a project-specific <code class="language-plaintext highlighter-rouge">codex.md</code> in your current working directory (or its parent Git repository root), it adds those instructions too. This lets project-specific rules override or add to your global ones.</li>
    </ul>
  </li>
</ol>

<h2 id="how-to-use-it-setting-your-preferences">How to Use It: Setting Your Preferences</h2>

<p>Letâ€™s make Codex always use <code class="language-plaintext highlighter-rouge">gpt-4o</code> and give it a global instruction.</p>

<p><strong>1. Set the Default Model:</strong></p>

<p>Create or edit the file <code class="language-plaintext highlighter-rouge">~/.codex/config.yaml</code> (you might need to create the <code class="language-plaintext highlighter-rouge">.codex</code> directory first). Add the following content:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># File: ~/.codex/config.yaml</span>

<span class="c1"># Use the gpt-4o model by default for all Codex runs</span>
<span class="na">model</span><span class="pi">:</span> <span class="s">gpt-4o</span>

<span class="c1"># Optional: How to handle errors when running commands in full-auto</span>
<span class="c1"># fullAutoErrorMode: ask-user # (Default) Ask user what to do</span>
<span class="c1"># fullAutoErrorMode: ignore-and-continue # Don't stop on error</span>
</code></pre></div></div>

<ul>
  <li><strong>Explanation:</strong> This simple YAML file tells Codex that your preferred <code class="language-plaintext highlighter-rouge">model</code> is <code class="language-plaintext highlighter-rouge">gpt-4o</code>. Now, you donâ€™t need to type <code class="language-plaintext highlighter-rouge">--model gpt-4o</code> every time!</li>
</ul>

<p><strong>2. Add Global Instructions:</strong></p>

<p>Create or edit the file <code class="language-plaintext highlighter-rouge">~/.codex/instructions.md</code>. Add some guidelines:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># File: ~/.codex/instructions.md</span>
<span class="p">
-</span> Always explain your reasoning step-by-step before suggesting code or commands.
<span class="p">-</span> Prefer using Python for scripting tasks unless otherwise specified.
<span class="p">-</span> Use emojis in your responses! ðŸŽ‰
</code></pre></div></div>

<ul>
  <li><strong>Explanation:</strong> This Markdown file gives the AI assistant general rules to follow during <em>any</em> conversation.</li>
</ul>

<p><strong>3. (Optional) Add Project Instructions:</strong></p>

<p>Navigate to your projectâ€™s root directory (e.g., <code class="language-plaintext highlighter-rouge">~/my-cool-project/</code>) and create a file named <code class="language-plaintext highlighter-rouge">codex.md</code>:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># File: ~/my-cool-project/codex.md</span>
<span class="p">
-</span> This project uses TypeScript and adheres to the Prettier style guide.
<span class="p">-</span> When adding new features, always include unit tests using Jest.
<span class="p">-</span> Do not run <span class="sb">`git push`</span> directly; always suggest creating a pull request.
</code></pre></div></div>

<ul>
  <li><strong>Explanation:</strong> When you run <code class="language-plaintext highlighter-rouge">codex</code> inside <code class="language-plaintext highlighter-rouge">~/my-cool-project/</code>, the AI will get <em>both</em> the global instructions <em>and</em> these project-specific ones.</li>
</ul>

<p>Now, when you run <code class="language-plaintext highlighter-rouge">codex</code> (without any flags overriding these settings), it will automatically:</p>

<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">gpt-4o</code> model.</li>
  <li>Receive the combined instructions (global + project-specific, if applicable) to guide its responses and actions.</li>
</ul>

<p>You can disable loading the project <code class="language-plaintext highlighter-rouge">codex.md</code> file by using the <code class="language-plaintext highlighter-rouge">--no-project-doc</code> flag if needed.</p>

<h2 id="under-the-hood-how-codex-loads-configuration">Under the Hood: How Codex Loads Configuration</h2>

<p>When you start the Codex CLI, one of the first things it does is figure out its configuration.</p>

<pre><code class="language-mermaid">sequenceDiagram
    participant CLI as Codex CLI Process
    participant ConfigLoader as config.ts (loadConfig)
    participant FileSystem as Your Computer's Files

    CLI-&gt;&gt;ConfigLoader: Start: Call loadConfig()
    ConfigLoader-&gt;&gt;FileSystem: Check for ~/.codex/config.yaml (or .json, .yml)?
    FileSystem--&gt;&gt;ConfigLoader: Found config.yaml
    ConfigLoader-&gt;&gt;FileSystem: Read ~/.codex/config.yaml
    FileSystem--&gt;&gt;ConfigLoader: YAML content (e.g., model: gpt-4o)
    ConfigLoader-&gt;&gt;ConfigLoader: Parse YAML, store model='gpt-4o'
    ConfigLoader-&gt;&gt;FileSystem: Check for ~/.codex/instructions.md?
    FileSystem--&gt;&gt;ConfigLoader: Found instructions.md
    ConfigLoader-&gt;&gt;FileSystem: Read ~/.codex/instructions.md
    FileSystem--&gt;&gt;ConfigLoader: Global instructions text
    ConfigLoader-&gt;&gt;FileSystem: Check for project 'codex.md' (discoverProjectDocPath)?
    FileSystem--&gt;&gt;ConfigLoader: Found project/codex.md
    ConfigLoader-&gt;&gt;FileSystem: Read project/codex.md
    FileSystem--&gt;&gt;ConfigLoader: Project instructions text
    ConfigLoader-&gt;&gt;ConfigLoader: Combine global + project instructions
    ConfigLoader--&gt;&gt;CLI: Return AppConfig object { model, instructions }
    CLI-&gt;&gt;CLI: Use AppConfig for AgentLoop, etc.
</code></pre>

<ol>
  <li><strong>Start:</strong> The main CLI process (<code class="language-plaintext highlighter-rouge">cli.tsx</code>) starts up.</li>
  <li><strong>Load Config:</strong> It calls the <code class="language-plaintext highlighter-rouge">loadConfig</code> function (from <code class="language-plaintext highlighter-rouge">utils/config.ts</code>).</li>
  <li><strong>Read Settings:</strong> <code class="language-plaintext highlighter-rouge">loadConfig</code> looks for <code class="language-plaintext highlighter-rouge">~/.codex/config.yaml</code> (or <code class="language-plaintext highlighter-rouge">.json</code>/<code class="language-plaintext highlighter-rouge">.yml</code>). If found, it reads the file, parses the YAML/JSON, and stores the settings (like <code class="language-plaintext highlighter-rouge">model</code>). If not found, it uses defaults (like <code class="language-plaintext highlighter-rouge">o4-mini</code>).</li>
  <li><strong>Read Global Instructions:</strong> It looks for <code class="language-plaintext highlighter-rouge">~/.codex/instructions.md</code>. If found, it reads the content.</li>
  <li><strong>Find Project Instructions:</strong> It calls helper functions like <code class="language-plaintext highlighter-rouge">discoverProjectDocPath</code> to search the current directory and parent directories (up to the Git root) for a <code class="language-plaintext highlighter-rouge">codex.md</code> file.</li>
  <li><strong>Read Project Instructions:</strong> If <code class="language-plaintext highlighter-rouge">codex.md</code> is found, it reads the content.</li>
  <li><strong>Combine:</strong> <code class="language-plaintext highlighter-rouge">loadConfig</code> concatenates the global and project instructions (if any) into a single string.</li>
  <li><strong>Return:</strong> It returns an <code class="language-plaintext highlighter-rouge">AppConfig</code> object containing the final model choice, the combined instructions, and other settings.</li>
  <li><strong>Use Config:</strong> The CLI process then uses this <code class="language-plaintext highlighter-rouge">AppConfig</code> object when setting up the <a href="03_agent_loop.md">Agent Loop</a> and other parts of the application.</li>
</ol>

<h2 id="diving-into-code-configts">Diving into Code (<code class="language-plaintext highlighter-rouge">config.ts</code>)</h2>

<p>The magic happens mainly in <code class="language-plaintext highlighter-rouge">codex-cli/src/utils/config.ts</code>.</p>

<p>Hereâ€™s how the CLI entry point (<code class="language-plaintext highlighter-rouge">cli.tsx</code>) uses <code class="language-plaintext highlighter-rouge">loadConfig</code>:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/cli.tsx (Simplified)</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">loadConfig</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./utils/config</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./app</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// ... other imports: React, render, meow ...</span>

<span class="c1">// --- Get command line arguments ---</span>
<span class="kd">const</span> <span class="nx">cli</span> <span class="o">=</span> <span class="nx">meow</span><span class="p">(</span><span class="cm">/* ... cli setup ... */</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">prompt</span> <span class="o">=</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">input</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">modelOverride</span> <span class="o">=</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">flags</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span> <span class="c1">// e.g., --model gpt-4</span>

<span class="c1">// --- Load Configuration ---</span>
<span class="c1">// loadConfig handles reading files and combining instructions</span>
<span class="kd">let</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">loadConfig</span><span class="p">(</span>
  <span class="kc">undefined</span><span class="p">,</span> <span class="c1">// Use default config file paths</span>
  <span class="kc">undefined</span><span class="p">,</span> <span class="c1">// Use default instructions file paths</span>
  <span class="p">{</span>
    <span class="na">cwd</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="c1">// Where are we running from? (for project docs)</span>
    <span class="na">disableProjectDoc</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">cli</span><span class="p">.</span><span class="nx">flags</span><span class="p">.</span><span class="nx">noProjectDoc</span><span class="p">),</span> <span class="c1">// Did user pass --no-project-doc?</span>
    <span class="na">projectDocPath</span><span class="p">:</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">flags</span><span class="p">.</span><span class="nx">projectDoc</span> <span class="k">as</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">,</span> <span class="c1">// Explicit project doc?</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// --- Apply Overrides ---</span>
<span class="c1">// Command-line flags take precedence over config file settings</span>
<span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">config</span><span class="p">,</span> <span class="c1">// Start with loaded config</span>
  <span class="na">model</span><span class="p">:</span> <span class="nx">modelOverride</span> <span class="o">??</span> <span class="nx">config</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="c1">// Use flag model if provided, else keep loaded one</span>
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="dl">"</span><span class="s2">OPENAI_API_KEY</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="dl">""</span><span class="p">,</span> <span class="c1">// Get API key from environment</span>
<span class="p">};</span>

<span class="c1">// --- Check Model Support ---</span>
<span class="c1">// ... check if config.model is valid ...</span>

<span class="c1">// --- Render the App ---</span>
<span class="c1">// Pass the final, combined config object to the main UI component</span>
<span class="kd">const</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">App</span>
    <span class="nx">prompt</span><span class="o">=</span><span class="p">{</span><span class="nx">prompt</span><span class="p">}</span>
    <span class="nx">config</span><span class="o">=</span><span class="p">{</span><span class="nx">config</span><span class="p">}</span> <span class="c1">// Use the loaded and merged configuration</span>
    <span class="c1">// ... other props: approvalPolicy, etc. ...</span>
  <span class="sr">/&gt;</span><span class="err">,
</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li><strong>Explanation:</strong> The code first calls <code class="language-plaintext highlighter-rouge">loadConfig</code>, passing options related to finding the project <code class="language-plaintext highlighter-rouge">codex.md</code>. It then merges these loaded settings with any overrides provided via command-line flags (like <code class="language-plaintext highlighter-rouge">--model</code>). The final <code class="language-plaintext highlighter-rouge">config</code> object is passed to the main React <code class="language-plaintext highlighter-rouge">&lt;App&gt;</code> component.</li>
</ul>

<p>Inside <code class="language-plaintext highlighter-rouge">config.ts</code>, the loading logic looks something like this:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/utils/config.ts (Simplified)</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">existsSync</span><span class="p">,</span> <span class="nx">readFileSync</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">load</span> <span class="k">as</span> <span class="nx">loadYaml</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">js-yaml</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">homedir</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">os</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">join</span><span class="p">,</span> <span class="nx">dirname</span><span class="p">,</span> <span class="nx">resolve</span> <span class="k">as</span> <span class="nx">resolvePath</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">CONFIG_DIR</span> <span class="o">=</span> <span class="nx">join</span><span class="p">(</span><span class="nx">homedir</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">.codex</span><span class="dl">"</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">CONFIG_YAML_FILEPATH</span> <span class="o">=</span> <span class="nx">join</span><span class="p">(</span><span class="nx">CONFIG_DIR</span><span class="p">,</span> <span class="dl">"</span><span class="s2">config.yaml</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// ... other paths: .json, .yml, instructions.md ...</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">DEFAULT_AGENTIC_MODEL</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">o4-mini</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Represents full runtime config</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">AppConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">apiKey</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">model</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">instructions</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="c1">// ... other settings ...</span>
<span class="p">};</span>

<span class="c1">// Options for loading</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">LoadConfigOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cwd</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">disableProjectDoc</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">projectDocPath</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">isFullContext</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">;</span> <span class="c1">// Affects default model choice</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">loadConfig</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">configPath</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=</span> <span class="nx">CONFIG_YAML_FILEPATH</span><span class="p">,</span> <span class="c1">// Default path</span>
  <span class="nx">instructionsPath</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=</span> <span class="nx">join</span><span class="p">(</span><span class="nx">CONFIG_DIR</span><span class="p">,</span> <span class="dl">"</span><span class="s2">instructions.md</span><span class="dl">"</span><span class="p">),</span>
  <span class="nx">options</span><span class="p">:</span> <span class="nx">LoadConfigOptions</span> <span class="o">=</span> <span class="p">{},</span>
<span class="p">):</span> <span class="nx">AppConfig</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="na">storedConfig</span><span class="p">:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// Holds data from config.yaml</span>

  <span class="c1">// 1. Find and read config.yaml/.json/.yml</span>
  <span class="kd">let</span> <span class="nx">actualConfigPath</span> <span class="o">=</span> <span class="cm">/* ... logic to find existing config file ... */</span> <span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">actualConfigPath</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="nx">actualConfigPath</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf-8</span><span class="dl">"</span><span class="p">);</span>
      <span class="c1">// Parse based on file extension (.yaml, .yml, .json)</span>
      <span class="nx">storedConfig</span> <span class="o">=</span> <span class="cm">/* ... parse YAML or JSON ... */</span> <span class="nx">raw</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="cm">/* ignore parse errors */</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 2. Read global instructions.md</span>
  <span class="kd">const</span> <span class="nx">userInstructions</span> <span class="o">=</span> <span class="nx">existsSync</span><span class="p">(</span><span class="nx">instructionsPath</span><span class="p">)</span>
    <span class="p">?</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="nx">instructionsPath</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf-8</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">:</span> <span class="dl">""</span><span class="p">;</span>

  <span class="c1">// 3. Read project codex.md (if enabled)</span>
  <span class="kd">let</span> <span class="nx">projectDoc</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">disableProjectDoc</span> <span class="cm">/* ... and env var check ... */</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">const</span> <span class="nx">cwd</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">cwd</span> <span class="o">??</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">();</span>
     <span class="c1">// loadProjectDoc handles discovery and reading the file</span>
     <span class="nx">projectDoc</span> <span class="o">=</span> <span class="nx">loadProjectDoc</span><span class="p">(</span><span class="nx">cwd</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">projectDocPath</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 4. Combine instructions</span>
  <span class="kd">const</span> <span class="nx">combinedInstructions</span> <span class="o">=</span> <span class="p">[</span><span class="nx">userInstructions</span><span class="p">,</span> <span class="nx">projectDoc</span><span class="p">]</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">?.</span><span class="nx">trim</span><span class="p">())</span> <span class="c1">// Remove empty strings</span>
    <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="se">\n\n</span><span class="s2">--- project-doc ---</span><span class="se">\n\n</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Join with separator</span>

  <span class="c1">// 5. Determine final model (use stored, else default)</span>
  <span class="kd">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">storedConfig</span><span class="p">.</span><span class="nx">model</span><span class="p">?.</span><span class="nx">trim</span><span class="p">()</span>
      <span class="p">?</span> <span class="nx">storedConfig</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span>
      <span class="p">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">isFullContext</span> <span class="p">?</span> <span class="cm">/* full ctx default */</span> <span class="p">:</span> <span class="nx">DEFAULT_AGENTIC_MODEL</span><span class="p">);</span>

  <span class="c1">// 6. Assemble the final config object</span>
  <span class="kd">const</span> <span class="na">config</span><span class="p">:</span> <span class="nx">AppConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">model</span><span class="p">:</span> <span class="nx">model</span><span class="p">,</span>
    <span class="na">instructions</span><span class="p">:</span> <span class="nx">combinedInstructions</span><span class="p">,</span>
    <span class="c1">// ... merge other settings from storedConfig ...</span>
  <span class="p">};</span>

  <span class="c1">// ... First-run bootstrap logic to create default files if missing ...</span>

  <span class="k">return</span> <span class="nx">config</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Helper to find and read project doc</span>
<span class="kd">function</span> <span class="nx">loadProjectDoc</span><span class="p">(</span><span class="nx">cwd</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">explicitPath</span><span class="p">?:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">filepath</span> <span class="o">=</span> <span class="nx">explicitPath</span>
      <span class="p">?</span> <span class="nx">resolvePath</span><span class="p">(</span><span class="nx">cwd</span><span class="p">,</span> <span class="nx">explicitPath</span><span class="p">)</span>
      <span class="p">:</span> <span class="nx">discoverProjectDocPath</span><span class="p">(</span><span class="nx">cwd</span><span class="p">);</span> <span class="c1">// Search logic</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">filepath</span> <span class="o">||</span> <span class="o">!</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">filepath</span><span class="p">))</span> <span class="k">return</span> <span class="dl">""</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="nx">filepath</span><span class="p">);</span>
    <span class="c1">// Limit size, return content</span>
    <span class="k">return</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="cm">/* MAX_BYTES */</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="dl">"</span><span class="s2">utf-8</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="k">return</span> <span class="dl">""</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Helper to find codex.md by walking up directories</span>
<span class="kd">function</span> <span class="nx">discoverProjectDocPath</span><span class="p">(</span><span class="nx">startDir</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">null</span> <span class="p">{</span>
  <span class="c1">// ... logic to check current dir, then walk up to git root ...</span>
  <span class="c1">// ... checks for codex.md, .codex.md etc. ...</span>
  <span class="k">return</span> <span class="cm">/* path or null */</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><strong>Explanation:</strong> <code class="language-plaintext highlighter-rouge">loadConfig</code> reads the YAML/JSON config file, reads the global <code class="language-plaintext highlighter-rouge">instructions.md</code>, uses helpers like <code class="language-plaintext highlighter-rouge">loadProjectDoc</code> and <code class="language-plaintext highlighter-rouge">discoverProjectDocPath</code> to find and read the project-specific <code class="language-plaintext highlighter-rouge">codex.md</code>, combines the instructions, determines the final model name (using defaults if necessary), and returns everything in a structured <code class="language-plaintext highlighter-rouge">AppConfig</code> object.</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>Configuration Management makes Codex much more convenient and personalized. By reading settings from <code class="language-plaintext highlighter-rouge">~/.codex/config.yaml</code> and instructions from <code class="language-plaintext highlighter-rouge">~/.codex/instructions.md</code> and project-specific <code class="language-plaintext highlighter-rouge">codex.md</code> files, it remembers your preferences (like your favorite AI model) and follows your standing orders without you needing to repeat them every time. This allows for a smoother and more consistent interaction tailored to your workflow and project needs.</p>

<p>So far, weâ€™ve mostly seen Codex working interactively in a chat-like loop. But what if you want Codex to perform a task and exit, perhaps as part of a script?</p>

<p>Next up: <a href="08_single_pass_mode.md">Single-Pass Mode</a></p>

<hr />

<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>
