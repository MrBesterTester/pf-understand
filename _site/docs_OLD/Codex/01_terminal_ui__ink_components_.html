<h1 id="chapter-1-terminal-ui-ink-components">Chapter 1: Terminal UI (Ink Components)</h1>

<p>Welcome to the Codex tutorial! We’re excited to have you explore how Codex works under the hood. This first chapter dives into how Codex creates its chat interface right inside your terminal window.</p>

<h2 id="whats-the-big-idea">What’s the Big Idea?</h2>

<p>Imagine you want <code class="language-plaintext highlighter-rouge">Codex</code> to write a simple script. You type something like <code class="language-plaintext highlighter-rouge">codex "write a python script that prints hello world"</code> into your terminal. How does Codex show you the conversation – your request, its response, maybe questions it asks, or commands it suggests running – all without opening a separate window? And how do you type your next message?</p>

<p>That’s where the <strong>Terminal UI</strong> comes in. It’s the system responsible for drawing the entire chat interface you see and interact with directly in your command line.</p>

<p>Think of it like the dashboard and controls of a car:</p>

<ul>
  <li><strong>Dashboard:</strong> Displays information (like the chat history, AI messages, loading indicators).</li>
  <li><strong>Controls (Steering Wheel, Pedals):</strong> Let you interact (like the input field where you type messages, or menus to approve commands).</li>
</ul>

<p>Just like the car’s dashboard lets you see what the engine is doing and control it, the Terminal UI lets you see what the core <code class="language-plaintext highlighter-rouge">Codex</code> logic (the <a href="03_agent_loop.md">Agent Loop</a>) is doing and provide input to it.</p>

<h2 id="key-concepts-ink--react">Key Concepts: Ink &amp; React</h2>

<p>How does Codex build this terminal interface? It uses two main technologies:</p>

<ol>
  <li>
    <p><strong>Ink:</strong> This is a fantastic library that lets developers build command-line interfaces using <strong>React</strong>. If you know React for web development, Ink feels very similar, but instead of rendering buttons and divs in a browser, it renders text, boxes, and lists in your terminal.</p>
  </li>
  <li>
    <p><strong>React Components:</strong> The UI is broken down into reusable pieces called React components. We have components for:</p>
    <ul>
      <li>Displaying individual messages (<code class="language-plaintext highlighter-rouge">TerminalChatResponseItem</code>).</li>
      <li>Showing the whole conversation history (<code class="language-plaintext highlighter-rouge">MessageHistory</code>).</li>
      <li>The text box where you type your input (<code class="language-plaintext highlighter-rouge">TerminalChatInput</code> / <code class="language-plaintext highlighter-rouge">TerminalChatNewInput</code>).</li>
      <li>Prompts asking you to approve commands (<code class="language-plaintext highlighter-rouge">TerminalChatCommandReview</code>).</li>
      <li>Spinners to show when Codex is thinking.</li>
    </ul>
  </li>
</ol>

<p>These components work together, managed by React, to create the dynamic interface you see.</p>

<h2 id="how-you-see-it-rendering-the-chat">How You See It: Rendering the Chat</h2>

<p>When you run <code class="language-plaintext highlighter-rouge">Codex</code>, the main application component (<code class="language-plaintext highlighter-rouge">App</code> in <code class="language-plaintext highlighter-rouge">app.tsx</code>) kicks things off. It might first check if you’re in a safe directory (like a Git repository) and ask for confirmation if not.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/app.tsx (Simplified)</span>

<span class="c1">// ... imports ...</span>
<span class="k">import</span> <span class="nx">TerminalChat</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./components/chat/terminal-chat</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ConfirmInput</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@inkjs/ui</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Box</span><span class="p">,</span> <span class="nx">Text</span><span class="p">,</span> <span class="nx">useApp</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ink</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">({</span> <span class="cm">/* ...props... */</span> <span class="p">}):</span> <span class="nx">JSX</span><span class="p">.</span><span class="nx">Element</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">useApp</span><span class="p">();</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">accepted</span><span class="p">,</span> <span class="nx">setAccepted</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inGitRepo</span> <span class="o">=</span> <span class="cm">/* ... check if in git ... */</span><span class="p">;</span>

  <span class="c1">// If not in a git repo and not yet accepted, show a warning</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">inGitRepo</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">accepted</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">flexDirection</span><span class="p">=</span><span class="s">"column"</span> <span class="cm">/* ...styling... */</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Text</span> <span class="na">color</span><span class="p">=</span><span class="s">"yellow"</span><span class="p">&gt;</span>Warning! Not in a git repo.<span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">ConfirmInput</span> <span class="c1">// &lt;-- An Ink component for Yes/No!</span>
          <span class="na">onConfirm</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setAccepted</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="si">}</span>
          <span class="na">onCancel</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span><span class="si">}</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Otherwise, render the main chat interface</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">TerminalChat</span> <span class="cm">/* ...props... */</span> <span class="p">/&gt;;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This snippet shows how the <code class="language-plaintext highlighter-rouge">App</code> component uses Ink’s <code class="language-plaintext highlighter-rouge">&lt;Box&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;Text&gt;</code>, and even interactive components like <code class="language-plaintext highlighter-rouge">&lt;ConfirmInput&gt;</code>. If the safety check passes, it renders the core <code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code> component.</p>

<p>The <code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code> component (<code class="language-plaintext highlighter-rouge">terminal-chat.tsx</code>) is the main hub for the chat UI. It manages the state, like the list of messages (<code class="language-plaintext highlighter-rouge">items</code>), whether the AI is currently working (<code class="language-plaintext highlighter-rouge">loading</code>), and any command confirmations needed (<code class="language-plaintext highlighter-rouge">confirmationPrompt</code>).</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/components/chat/terminal-chat.tsx (Simplified)</span>

<span class="c1">// ... imports ...</span>
<span class="k">import</span> <span class="nx">TerminalMessageHistory</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./terminal-message-history</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">TerminalChatInput</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./terminal-chat-input</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Or TerminalChatNewInput</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Box</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ink</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">TerminalChat</span><span class="p">({</span> <span class="cm">/* ...props... */</span> <span class="p">}):</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactElement</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">items</span><span class="p">,</span> <span class="nx">setItems</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nb">Array</span><span class="o">&lt;</span><span class="nx">ResponseItem</span><span class="o">&gt;&gt;</span><span class="p">([]);</span> <span class="c1">// Holds all messages</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span> <span class="c1">// Is the AI busy?</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">confirmationPrompt</span><span class="p">,</span> <span class="nx">setConfirmationPrompt</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span> <span class="c1">// Command to review?</span>
  <span class="c1">// ... other state and logic ...</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">flexDirection</span><span class="p">=</span><span class="s">"column"</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="cm">/* Display the conversation history */</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nc">TerminalMessageHistory</span>
        <span class="na">batch</span><span class="p">=</span><span class="si">{</span><span class="cm">/* ...derived from items... */</span><span class="si">}</span>
        <span class="na">loading</span><span class="p">=</span><span class="si">{</span><span class="nx">loading</span><span class="si">}</span>
        <span class="cm">/* ...other props... */</span>
      <span class="p">/&gt;</span>

      <span class="si">{</span><span class="cm">/* Display the input box or the command review prompt */</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nc">TerminalChatInput</span> <span class="c1">// Or TerminalChatNewInput</span>
        <span class="na">loading</span><span class="p">=</span><span class="si">{</span><span class="nx">loading</span><span class="si">}</span>
        <span class="na">confirmationPrompt</span><span class="p">=</span><span class="si">{</span><span class="nx">confirmationPrompt</span><span class="si">}</span>
        <span class="na">submitInput</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="cm">/*...user input...*/</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* Send to Agent Loop */</span> <span class="p">}</span><span class="si">}</span>
        <span class="na">submitConfirmation</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="cm">/*...decision...*/</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* Send to Agent Loop */</span> <span class="p">}</span><span class="si">}</span>
        <span class="cm">/* ...other props... */</span>
      <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;TerminalMessageHistory&gt;</code> takes the list of <code class="language-plaintext highlighter-rouge">items</code> (messages) and renders them.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;TerminalChatInput&gt;</code> (or its multiline sibling <code class="language-plaintext highlighter-rouge">&lt;TerminalChatNewInput&gt;</code>) displays the input box when <code class="language-plaintext highlighter-rouge">loading</code> is false and there’s no <code class="language-plaintext highlighter-rouge">confirmationPrompt</code>. If there <em>is</em> a <code class="language-plaintext highlighter-rouge">confirmationPrompt</code>, it shows the command review UI instead.</li>
</ul>

<h3 id="showing-messages">Showing Messages</h3>

<p>How does <code class="language-plaintext highlighter-rouge">&lt;TerminalMessageHistory&gt;</code> actually display the messages? It uses a special Ink component called <code class="language-plaintext highlighter-rouge">&lt;Static&gt;</code> for efficiency and maps each message <code class="language-plaintext highlighter-rouge">item</code> to a <code class="language-plaintext highlighter-rouge">&lt;TerminalChatResponseItem&gt;</code>.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/components/chat/terminal-message-history.tsx (Simplified)</span>

<span class="c1">// ... imports ...</span>
<span class="k">import</span> <span class="nx">TerminalChatResponseItem</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./terminal-chat-response-item</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Box</span><span class="p">,</span> <span class="nx">Static</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ink</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">MessageHistory</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span><span class="nx">MessageHistoryProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">batch</span><span class="p">,</span> <span class="cm">/* ... */</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Extract the actual message objects</span>
  <span class="kd">const</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">batch</span><span class="p">.</span><span class="nx">map</span><span class="p">(({</span> <span class="nx">item</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="o">!</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">flexDirection</span><span class="p">=</span><span class="s">"column"</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="cm">/* &lt;Static&gt; renders past items efficiently */</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nc">Static</span> <span class="na">items</span><span class="p">=</span><span class="si">{</span><span class="nx">messages</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
          <span class="c1">// Render each message using TerminalChatResponseItem</span>
          <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">key</span><span class="p">=</span><span class="si">{</span><span class="s2">`</span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">`</span><span class="si">}</span> <span class="cm">/* ...styling... */</span> <span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">TerminalChatResponseItem</span> <span class="na">item</span><span class="p">=</span><span class="si">{</span><span class="nx">message</span><span class="si">}</span> <span class="p">/&gt;</span>
          <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
        <span class="p">)</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nc">Static</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">MessageHistory</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">&lt;Static&gt;</code> tells Ink that these items won’t change often, allowing Ink to optimize rendering. Each message is passed to <code class="language-plaintext highlighter-rouge">&lt;TerminalChatResponseItem&gt;</code>.</p>

<p>Inside <code class="language-plaintext highlighter-rouge">TerminalChatResponseItem</code> (<code class="language-plaintext highlighter-rouge">terminal-chat-response-item.tsx</code>), we figure out what <em>kind</em> of message it is (user message, AI response, command output, etc.) and render it accordingly using Ink’s basic <code class="language-plaintext highlighter-rouge">&lt;Text&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;Box&gt;</code> components, sometimes with helpers like <code class="language-plaintext highlighter-rouge">&lt;Markdown&gt;</code> for formatting.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/components/chat/terminal-chat-response-item.tsx (Simplified)</span>

<span class="c1">// ... imports ...</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Box</span><span class="p">,</span> <span class="nx">Text</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ink</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// ... other components like Markdown ...</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">TerminalChatResponseItem</span><span class="p">({</span> <span class="nx">item</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">item</span><span class="p">:</span> <span class="nx">ResponseItem</span> <span class="p">}):</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactElement</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span> <span class="c1">// User or AI text message</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">flexDirection</span><span class="p">=</span><span class="s">"column"</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">Text</span> <span class="na">bold</span> <span class="na">color</span><span class="p">=</span><span class="si">{</span><span class="cm">/* color based on role */</span><span class="si">}</span><span class="p">&gt;</span>
            <span class="si">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">role</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">assistant</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">codex</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">role</span><span class="si">}</span>
          <span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="cm">/* Render message content, potentially using Markdown */</span><span class="si">}</span>
          <span class="p">&lt;</span><span class="nc">Text</span><span class="p">&gt;</span><span class="si">{</span><span class="cm">/* ... content ... */</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
      <span class="p">);</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">function_call</span><span class="dl">"</span><span class="p">:</span> <span class="c1">// AI wants to run a command</span>
       <span class="k">return</span> <span class="p">(</span>
         <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">flexDirection</span><span class="p">=</span><span class="s">"column"</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nc">Text</span> <span class="na">color</span><span class="p">=</span><span class="s">"magentaBright"</span> <span class="na">bold</span><span class="p">&gt;</span>command<span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nc">Text</span><span class="p">&gt;&lt;</span><span class="nc">Text</span> <span class="na">dimColor</span><span class="p">&gt;</span>$<span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span> <span class="si">{</span><span class="cm">/* Formatted command */</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span>
         <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
       <span class="p">);</span>
    <span class="c1">// ... other cases like function_call_output ...</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Text</span><span class="p">&gt;</span>Unknown message type<span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="getting-your-input">Getting Your Input</h3>

<p>The <code class="language-plaintext highlighter-rouge">&lt;TerminalChatInput&gt;</code> (or <code class="language-plaintext highlighter-rouge">&lt;TerminalChatNewInput&gt;</code>) component uses specialized input components (like <code class="language-plaintext highlighter-rouge">&lt;TextInput&gt;</code> from <code class="language-plaintext highlighter-rouge">ink-text-input</code> or our custom <code class="language-plaintext highlighter-rouge">&lt;MultilineTextEditor&gt;</code>) to capture your keystrokes. When you press Enter, it calls the <code class="language-plaintext highlighter-rouge">onSubmit</code> or <code class="language-plaintext highlighter-rouge">submitInput</code> function provided by <code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code>.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/components/chat/terminal-chat-new-input.tsx (Simplified)</span>

<span class="c1">// ... imports ...</span>
<span class="k">import</span> <span class="nx">MultilineTextEditor</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./multiline-editor</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Custom multiline input</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Box</span><span class="p">,</span> <span class="nx">Text</span><span class="p">,</span> <span class="nx">useInput</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ink</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">TerminalChatInput</span><span class="p">({</span> <span class="nx">submitInput</span><span class="p">,</span> <span class="nx">active</span><span class="p">,</span> <span class="cm">/* ... */</span> <span class="p">}):</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactElement</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">input</span><span class="p">,</span> <span class="nx">setInput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span> <span class="c1">// Current text in the editor</span>
  <span class="kd">const</span> <span class="nx">editorRef</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useRef</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span> <span class="c1">// Handle to editor</span>

  <span class="c1">// useInput hook from Ink handles key presses (like Up/Down for history)</span>
  <span class="nx">useInput</span><span class="p">((</span><span class="nx">_input</span><span class="p">,</span> <span class="nx">_key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="c1">// Handle history navigation (Up/Down arrows)</span>
     <span class="c1">// ... logic using editorRef.current.getRow() ...</span>
  <span class="p">},</span> <span class="p">{</span> <span class="na">isActive</span><span class="p">:</span> <span class="nx">active</span> <span class="p">});</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">flexDirection</span><span class="p">=</span><span class="s">"column"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">borderStyle</span><span class="p">=</span><span class="s">"round"</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="cm">/* The actual input field */</span><span class="si">}</span>
        <span class="p">&lt;</span><span class="nc">MultilineTextEditor</span>
          <span class="na">ref</span><span class="p">=</span><span class="si">{</span><span class="nx">editorRef</span><span class="si">}</span>
          <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">txt</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setInput</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span><span class="si">}</span>
          <span class="na">initialText</span><span class="p">=</span><span class="si">{</span><span class="nx">input</span><span class="si">}</span>
          <span class="na">focus</span><span class="p">=</span><span class="si">{</span><span class="nx">active</span><span class="si">}</span> <span class="c1">// Only active when overlay isn't shown</span>
          <span class="na">onSubmit</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// When Enter is pressed (and not escaped)</span>
            <span class="nx">submitInput</span><span class="p">(</span><span class="cm">/* ...create input item from text... */</span><span class="p">);</span>
            <span class="nx">setInput</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span> <span class="c1">// Clear the input field</span>
          <span class="p">}</span><span class="si">}</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="cm">/* Help text */</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nc">Text</span> <span class="na">dimColor</span><span class="p">&gt;</span>ctrl+c to exit | enter to send<span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This component manages the text you type and uses Ink’s <code class="language-plaintext highlighter-rouge">useInput</code> hook to handle special keys like arrow keys for command history. The details of text editing are handled in the next chapter: <a href="02_input_handling__textbuffer_editor_.md">Input Handling (TextBuffer/Editor)</a>.</p>

<h3 id="reviewing-commands">Reviewing Commands</h3>

<p>If the <a href="03_agent_loop.md">Agent Loop</a> decides it needs to run a command and requires your approval, <code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code> will receive a <code class="language-plaintext highlighter-rouge">confirmationPrompt</code>. This prompt (which is itself a React element, often <code class="language-plaintext highlighter-rouge">&lt;TerminalChatToolCallCommand&gt;</code>) is passed down to <code class="language-plaintext highlighter-rouge">&lt;TerminalChatInput&gt;</code>, which then renders <code class="language-plaintext highlighter-rouge">&lt;TerminalChatCommandReview&gt;</code> instead of the regular input box.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// File: codex-cli/src/components/chat/terminal-chat-command-review.tsx (Simplified)</span>

<span class="c1">// ... imports ...</span>
<span class="c1">// @ts-expect-error - Using a vendor component for selection</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Select</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../vendor/ink-select/select</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">TextInput</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../vendor/ink-text-input</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// For editing feedback</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Box</span><span class="p">,</span> <span class="nx">Text</span><span class="p">,</span> <span class="nx">useInput</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ink</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">TerminalChatCommandReview</span><span class="p">({</span>
  <span class="nx">confirmationPrompt</span><span class="p">,</span> <span class="c1">// The command display element</span>
  <span class="nx">onReviewCommand</span><span class="p">,</span> <span class="c1">// Function to call with the decision</span>
<span class="p">}:</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}):</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactElement</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">setMode</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="o">&lt;</span><span class="dl">"</span><span class="s2">select</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">input</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">"</span><span class="s2">select</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Select Yes/No or type feedback</span>

  <span class="c1">// Options for the selection list</span>
  <span class="kd">const</span> <span class="nx">approvalOptions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Yes (y)</span><span class="dl">"</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">ReviewDecision</span><span class="p">.</span><span class="nx">YES</span> <span class="p">},</span>
    <span class="c1">// ... other options like Always, Edit, No ...</span>
  <span class="p">];</span>

  <span class="nx">useInput</span><span class="p">((</span><span class="nx">input</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* Handle shortcuts like 'y', 'n', 'e', Esc */</span> <span class="p">});</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Box</span> <span class="na">flexDirection</span><span class="p">=</span><span class="s">"column"</span> <span class="na">borderStyle</span><span class="p">=</span><span class="s">"round"</span> <span class="na">marginTop</span><span class="p">=</span><span class="si">{</span><span class="mi">1</span><span class="si">}</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="cm">/* Display the command that needs review */</span><span class="si">}</span>
      <span class="si">{</span><span class="nx">confirmationPrompt</span><span class="si">}</span>

      <span class="si">{</span><span class="nx">mode</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">select</span><span class="dl">"</span> <span class="p">?</span> <span class="p">(</span>
        <span class="p">&lt;&gt;</span>
          <span class="p">&lt;</span><span class="nc">Text</span><span class="p">&gt;</span>Allow command?<span class="p">&lt;/</span><span class="nc">Text</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">Select</span> <span class="c1">// Ink component for selection lists</span>
            <span class="na">options</span><span class="p">=</span><span class="si">{</span><span class="nx">approvalOptions</span><span class="si">}</span>
            <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... call onReviewCommand or setMode('input') ... */</span> <span class="p">}</span><span class="si">}</span>
          <span class="p">/&gt;</span>
        <span class="p">&lt;/&gt;</span>
      <span class="p">)</span> <span class="p">:</span> <span class="p">(</span>
        <span class="cm">/* UI for typing feedback (TextInput) */</span>
        <span class="c1">// ...</span>
      <span class="p">)</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nc">Box</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This component shows the command passed in (<code class="language-plaintext highlighter-rouge">confirmationPrompt</code>), presents options using Ink’s <code class="language-plaintext highlighter-rouge">&lt;Select&gt;</code> component (or a <code class="language-plaintext highlighter-rouge">&lt;TextInput&gt;</code> if you choose to edit/give feedback), listens for your choice (via keyboard shortcuts or the selection list), and finally calls <code class="language-plaintext highlighter-rouge">onReviewCommand</code> with your decision.</p>

<h2 id="under-the-hood-how-it-all-connects">Under the Hood: How It All Connects</h2>

<p>Let’s trace the flow from starting Codex to seeing an AI response:</p>

<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant Terminal
    participant CodexCLI
    participant InkReactApp as Ink/React UI
    participant AgentLoop as Agent Loop

    User-&gt;&gt;Terminal: Runs `codex "prompt"`
    Terminal-&gt;&gt;CodexCLI: Starts the process
    CodexCLI-&gt;&gt;InkReactApp: Renders initial UI (`App` -&gt; `TerminalChat`)
    InkReactApp-&gt;&gt;Terminal: Displays UI (header, empty chat, input box)
    User-&gt;&gt;Terminal: Types message, presses Enter
    Terminal-&gt;&gt;InkReactApp: Captures input (`TerminalChatInput`)
    InkReactApp-&gt;&gt;AgentLoop: Sends user input via `submitInput` prop (in `TerminalChat`)
    Note over AgentLoop: Processes input, calls LLM...
    AgentLoop-&gt;&gt;InkReactApp: Sends back AI response via `onItem` prop (in `TerminalChat`)
    InkReactApp-&gt;&gt;InkReactApp: Updates state (`items`), triggers re-render
    InkReactApp-&gt;&gt;Terminal: Re-renders UI with new message (`MessageHistory`)
</code></pre>

<ol>
  <li>You run <code class="language-plaintext highlighter-rouge">codex</code>.</li>
  <li>The CLI process starts.</li>
  <li>The React application (<code class="language-plaintext highlighter-rouge">App</code> -&gt; <code class="language-plaintext highlighter-rouge">TerminalChat</code>) renders the initial UI using Ink components. Ink translates these components into terminal commands to draw the interface.</li>
  <li>You type your message into the <code class="language-plaintext highlighter-rouge">&lt;TerminalChatInput&gt;</code> component.</li>
  <li>When you press Enter, the input component’s <code class="language-plaintext highlighter-rouge">onSubmit</code> handler is called.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code> receives this, packages it, and calls the <code class="language-plaintext highlighter-rouge">run</code> method on the <a href="03_agent_loop.md">Agent Loop</a>.</li>
  <li>The Agent Loop processes the input (often calling an LLM).</li>
  <li>When the Agent Loop has something to display (like the AI’s text response), it calls the <code class="language-plaintext highlighter-rouge">onItem</code> callback function provided by <code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code> receives the new message item and updates its <code class="language-plaintext highlighter-rouge">items</code> state using <code class="language-plaintext highlighter-rouge">setItems</code>.</li>
  <li>React detects the state change and tells Ink to re-render the necessary components (like adding the new message to <code class="language-plaintext highlighter-rouge">&lt;TerminalMessageHistory&gt;</code>).</li>
  <li>Ink updates the terminal display.</li>
</ol>

<p>The process for handling command confirmations is similar, involving the <code class="language-plaintext highlighter-rouge">getCommandConfirmation</code> and <code class="language-plaintext highlighter-rouge">submitConfirmation</code> callbacks between <code class="language-plaintext highlighter-rouge">&lt;TerminalChat&gt;</code> and the Agent Loop, rendering <code class="language-plaintext highlighter-rouge">&lt;TerminalChatCommandReview&gt;</code> in the UI when needed.</p>

<h2 id="conclusion">Conclusion</h2>

<p>You’ve now seen how Codex uses the power of React and the Ink library to build a fully interactive chat interface directly within your terminal. This “Terminal UI” layer acts as the visual front-end, displaying messages, capturing your input, and presenting choices like command approvals, all while coordinating with the core <a href="03_agent_loop.md">Agent Loop</a> behind the scenes.</p>

<p>But how exactly does that input box capture your keystrokes, handle multi-line editing, and manage command history? We’ll explore that in the next chapter.</p>

<p>Next up: <a href="02_input_handling__textbuffer_editor_.md">Input Handling (TextBuffer/Editor)</a></p>

<hr />

<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>
