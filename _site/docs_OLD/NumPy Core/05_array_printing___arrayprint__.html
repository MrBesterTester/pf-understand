<h1 id="chapter-5-array-printing-arrayprint">Chapter 5: Array Printing (<code class="language-plaintext highlighter-rouge">arrayprint</code>)</h1>

<p>In the previous chapter, <a href="04_numeric_types___numerictypes__.md">Chapter 4: Numeric Types (<code class="language-plaintext highlighter-rouge">numerictypes</code>)</a>, we explored the different kinds of data NumPy can store in its arrays, like <code class="language-plaintext highlighter-rouge">int32</code>, <code class="language-plaintext highlighter-rouge">float64</code>, and more. Now that we know about the arrays (<a href="01_ndarray__n_dimensional_array_.md"><code class="language-plaintext highlighter-rouge">ndarray</code></a>), their data types (<a href="02_dtype__data_type_object_.md"><code class="language-plaintext highlighter-rouge">dtype</code></a>), the functions that operate on them (<a href="03_ufunc__universal_function_.md"><code class="language-plaintext highlighter-rouge">ufunc</code></a>), and the specific number types (<code class="language-plaintext highlighter-rouge">numerictypes</code>), a practical question arises: How do we actually <em>look</em> at these arrays, especially if they are very large?</p>

<h2 id="what-problem-does-arrayprint-solve-making-arrays-readable">What Problem Does <code class="language-plaintext highlighter-rouge">arrayprint</code> Solve? Making Arrays Readable</h2>

<p>Imagine you have a NumPy array representing a large image, maybe with millions of pixel values. Or perhaps you have simulation data with thousands of temperature readings.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># Imagine this is a huge array, maybe thousands of numbers
</span><span class="n">large_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>

<span class="c1"># If Python just tried to print every single number...
# it would flood your screen and be impossible to read!
# print(list(large_array)) # &lt;-- Don't run this! It would be too long.
</span></code></pre></div></div>

<p>If NumPy just dumped <em>all</em> the numbers onto your screen whenever you tried to display a large array, it would be overwhelming and useless. We need a way to show the array’s contents in a concise, human-friendly format. How can we get a <em>sense</em> of the array’s data without printing every single element?</p>

<p>This is the job of NumPy’s <strong>array printing</strong> mechanism, often referred to internally by the name of its main Python module, <code class="language-plaintext highlighter-rouge">arrayprint</code>.</p>

<h2 id="what-is-array-printing-arrayprint">What is Array Printing (<code class="language-plaintext highlighter-rouge">arrayprint</code>)?</h2>

<p><code class="language-plaintext highlighter-rouge">arrayprint</code> is NumPy’s <strong>“pretty printer”</strong> for <code class="language-plaintext highlighter-rouge">ndarray</code> objects. It’s responsible for converting a NumPy array into a nicely formatted string representation that’s easy to read and understand when you display it (e.g., in your Python console, Jupyter notebook, or using the <code class="language-plaintext highlighter-rouge">print()</code> function).</p>

<p>Think of it like getting a summary report instead of the raw database dump. <code class="language-plaintext highlighter-rouge">arrayprint</code> intelligently decides how to show the array, considering things like:</p>

<ul>
  <li><strong>Summarization:</strong> For large arrays, it shows only the beginning and end elements, using ellipsis (<code class="language-plaintext highlighter-rouge">...</code>) to indicate the omitted parts.</li>
  <li><strong>Precision:</strong> It controls how many decimal places are shown for floating-point numbers.</li>
  <li><strong>Line Wrapping:</strong> It breaks long rows of data into multiple lines to fit within a certain width.</li>
  <li><strong>Special Values:</strong> It uses consistent strings for “Not a Number” (<code class="language-plaintext highlighter-rouge">nan</code>) and infinity (<code class="language-plaintext highlighter-rouge">inf</code>).</li>
  <li><strong>Customization:</strong> It allows you to change these settings to suit your needs.</li>
</ul>

<p>Let’s see it in action with our <code class="language-plaintext highlighter-rouge">large_array</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">large_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>

<span class="c1"># Let NumPy's array printing handle it
</span><span class="k">print</span><span class="p">(</span><span class="n">large_array</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Output:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[   0    1    2 ... 1997 1998 1999]
</code></pre></div></div>

<p>Instead of 2000 numbers flooding the screen, NumPy smartly printed only the first three and the last three, with <code class="language-plaintext highlighter-rouge">...</code> in between. This gives us a good idea of the array’s contents (a sequence starting from 0) without being overwhelming.</p>

<h2 id="key-features-and-options">Key Features and Options</h2>

<p><code class="language-plaintext highlighter-rouge">arrayprint</code> has several options you can control to change how arrays are displayed.</p>

<h3 id="1-summarization-threshold-and-edgeitems">1. Summarization (<code class="language-plaintext highlighter-rouge">threshold</code> and <code class="language-plaintext highlighter-rouge">edgeitems</code>)</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">threshold</code>: The total number of array elements that triggers summarization. If the array’s <code class="language-plaintext highlighter-rouge">size</code> is greater than <code class="language-plaintext highlighter-rouge">threshold</code>, the array gets summarized. (Default: 1000)</li>
  <li><code class="language-plaintext highlighter-rouge">edgeitems</code>: When summarizing, this is the number of items shown at the beginning and end of each dimension. (Default: 3)</li>
</ul>

<p>Let’s try printing a smaller array and then changing the threshold:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># An array with 10 elements
</span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Original:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

<span class="c1"># Temporarily set the threshold lower (e.g., 5)
# We use np.printoptions as a context manager for temporary settings
</span><span class="k">with</span> <span class="n">np</span><span class="p">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">With threshold=5:"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

<span class="c1"># Change edgeitems too
</span><span class="k">with</span> <span class="n">np</span><span class="p">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgeitems</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">With threshold=5, edgeitems=2:"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Output:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Original:
[0 1 2 3 4 5 6 7 8 9]

With threshold=5:
[0 1 2 ... 7 8 9]

With threshold=5, edgeitems=2:
[0 1 ... 8 9]
</code></pre></div></div>
<p>You can see how lowering the <code class="language-plaintext highlighter-rouge">threshold</code> caused the array (size 10) to be summarized, and <code class="language-plaintext highlighter-rouge">edgeitems</code> controlled how many elements were shown at the ends.</p>

<h3 id="2-floating-point-precision-precision-and-suppress">2. Floating-Point Precision (<code class="language-plaintext highlighter-rouge">precision</code> and <code class="language-plaintext highlighter-rouge">suppress</code>)</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">precision</code>: Controls the number of digits displayed after the decimal point for floats. (Default: 8)</li>
  <li><code class="language-plaintext highlighter-rouge">suppress</code>: If <code class="language-plaintext highlighter-rouge">True</code>, prevents NumPy from using scientific notation for very small numbers and prints them as zero if they are smaller than the current precision. (Default: False)</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># An array with floating-point numbers
</span><span class="n">float_arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.123456789</span><span class="p">,</span> <span class="mf">1.5e-10</span><span class="p">,</span> <span class="mf">2.987</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Default precision:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">float_arr</span><span class="p">)</span>

<span class="c1"># Set precision to 3
</span><span class="k">with</span> <span class="n">np</span><span class="p">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">With precision=3:"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">float_arr</span><span class="p">)</span>

<span class="c1"># Set precision to 3 and suppress small numbers
</span><span class="k">with</span> <span class="n">np</span><span class="p">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">With precision=3, suppress=True:"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">float_arr</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Output:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Default precision:
[1.23456789e-01 1.50000000e-10 2.98700000e+00]

With precision=3:
[1.235e-01 1.500e-10 2.987e+00]

With precision=3, suppress=True:
[0.123 0.    2.987]
</code></pre></div></div>
<p>Notice how <code class="language-plaintext highlighter-rouge">precision</code> changed the rounding, and <code class="language-plaintext highlighter-rouge">suppress=True</code> made the very small number (<code class="language-plaintext highlighter-rouge">1.5e-10</code>) display as <code class="language-plaintext highlighter-rouge">0.</code> and switched from scientific notation to fixed-point for the others. There’s also a <code class="language-plaintext highlighter-rouge">floatmode</code> option for more fine-grained control over float formatting (e.g., ‘fixed’, ‘unique’).</p>

<h3 id="3-line-width-linewidth">3. Line Width (<code class="language-plaintext highlighter-rouge">linewidth</code>)</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">linewidth</code>: The maximum number of characters allowed per line before wrapping. (Default: 75)</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># A 2D array
</span><span class="n">arr2d</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Default linewidth:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">arr2d</span><span class="p">)</span>

<span class="c1"># Set a narrow linewidth
</span><span class="k">with</span> <span class="n">np</span><span class="p">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">With linewidth=30:"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">arr2d</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Output:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Default linewidth:
[[0.  0.1 0.2 0.3]
 [0.4 0.5 0.6 0.7]
 [0.8 0.9 1.  1.1]]

With linewidth=30:
[[0.  0.1 0.2 0.3]
 [0.4 0.5 0.6 0.7]
 [0.8 0.9 1.  1.1]]
</code></pre></div></div>
<p><em>(Note: The output might not actually wrap here because the lines are short. If the array was wider, you’d see the rows break across multiple lines with the narrower <code class="language-plaintext highlighter-rouge">linewidth</code> setting.)</em></p>

<h3 id="4-other-options">4. Other Options</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">nanstr</code>: String representation for Not a Number. (Default: ‘nan’)</li>
  <li><code class="language-plaintext highlighter-rouge">infstr</code>: String representation for Infinity. (Default: ‘inf’)</li>
  <li><code class="language-plaintext highlighter-rouge">sign</code>: Control sign display for floats (‘-‘, ‘+’, or ‘ ‘).</li>
  <li><code class="language-plaintext highlighter-rouge">formatter</code>: A dictionary to provide completely custom formatting functions for specific data types (like bool, int, float, datetime, etc.). This is more advanced.</li>
</ul>

<h2 id="using-and-customizing-array-printing">Using and Customizing Array Printing</h2>

<p>You usually interact with array printing implicitly just by displaying an array:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># These both use NumPy's array printing behind the scenes
</span><span class="k">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>         <span class="c1"># Calls __str__ -&gt; array_str -&gt; array2string
</span><span class="n">arr</span>                <span class="c1"># In interactive sessions, calls __repr__ -&gt; array_repr -&gt; array2string
</span></code></pre></div></div>

<p>To customize the output, you can use:</p>

<ol>
  <li><strong><code class="language-plaintext highlighter-rouge">np.set_printoptions(...)</code>:</strong> Sets options globally (for your entire Python session).</li>
  <li><strong><code class="language-plaintext highlighter-rouge">np.get_printoptions()</code>:</strong> Returns a dictionary of the current settings.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">np.printoptions(...)</code>:</strong> A context manager to set options <em>temporarily</em> within a <code class="language-plaintext highlighter-rouge">with</code> block (as used in the examples above). This is often the preferred way to avoid changing settings permanently.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">np.array2string(...)</code>:</strong> A function to get the string representation directly, allowing you to override options just for that one call.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">sys</span> <span class="c1"># Needed for sys.maxsize
</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>

<span class="c1"># --- Global Setting ---
</span><span class="k">print</span><span class="p">(</span><span class="s">"--- Setting threshold globally ---"</span><span class="p">)</span>
<span class="n">original_options</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">get_printoptions</span><span class="p">()</span> <span class="c1"># Store original settings
</span><span class="n">np</span><span class="p">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="o">**</span><span class="n">original_options</span><span class="p">)</span> <span class="c1"># Restore original settings
</span>
<span class="c1"># --- Temporary Setting (Context Manager) ---
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">--- Setting precision temporarily ---"</span><span class="p">)</span>
<span class="k">with</span> <span class="n">np</span><span class="p">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">--- Back to default precision ---"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="c1"># Options are automatically restored outside the 'with' block
</span>
<span class="c1"># --- Direct Call with Overrides ---
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">--- Using array2string with summarization off ---"</span><span class="p">)</span>
<span class="c1"># Use sys.maxsize to effectively disable summarization
</span><span class="n">arr_string</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array2string</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">maxsize</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># print(arr_string) # This might still be very long! Let's just print the first few lines
</span><span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr_string</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()[:</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">...'</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Output (will vary due to random numbers):</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--- Setting threshold globally ---
[[992.84337197 931.73648142 119.68616987 ... 305.61919366 516.97897205
  707.69140878]
 [507.45895986 253.00740626 739.97091378 ... 755.69943511 813.11931119
   19.84654589]
 [941.25264871 689.43209981 820.11954711 ... 709.83933545 192.49837505
  609.30358618]
 ...
 [498.86686503 872.79555956 401.19333028 ... 552.97492858 303.59379464
  308.61881807]
 [797.51920685 427.86020151 783.2019203  ... 511.63382762 322.52764881
  778.22766019]
 [ 54.84391309 938.24403397 796.7431406  ... 495.90873227 267.16620292
  409.51491904]]

--- Setting precision temporarily ---
[[992.84 931.74 119.69 ... 305.62 516.98 707.69]
 [507.46 253.01 739.97 ... 755.7  813.12  19.85]
 [941.25 689.43 820.12 ... 709.84 192.5  609.3 ]
 ...
 [498.87 872.8  401.19 ... 552.97 303.59 308.62]
 [797.52 427.86 783.2  ... 511.63 322.53 778.23]
 [ 54.84 938.24 796.74 ... 495.91 267.17 409.51]]

--- Back to default precision ---
[[992.84337197 931.73648142 119.68616987 ... 305.61919366 516.97897205
  707.69140878]
 [507.45895986 253.00740626 739.97091378 ... 755.69943511 813.11931119
   19.84654589]
 [941.25264871 689.43209981 820.11954711 ... 709.83933545 192.49837505
  609.30358618]
 ...
 [498.86686503 872.79555956 401.19333028 ... 552.97492858 303.59379464
  308.61881807]
 [797.51920685 427.86020151 783.2019203  ... 511.63382762 322.52764881
  778.22766019]
 [ 54.84391309 938.24403397 796.7431406  ... 495.90873227 267.16620292
  409.51491904]]

--- Using array2string with summarization off ---
[[992.8 931.7 119.7 922.  912.2 156.5 459.4 305.6 517.  707.7]
 [507.5 253.  740.  640.3 420.3 652.1 197.  755.7 813.1  19.8]
 [941.3 689.4 820.1 125.8 598.2 219.3 466.7 709.8 192.5 609.3]
 [ 32.  855.2 362.1 434.9 133.5 148.1 522.6 725.1 395.5 377.9]
 [332.7 782.2 587.3 320.3 905.5 412.8 378.  911.9 972.1 400.2]
...
</code></pre></div></div>

<h2 id="a-glimpse-under-the-hood">A Glimpse Under the Hood</h2>

<p>What happens when you call <code class="language-plaintext highlighter-rouge">print(my_array)</code>?</p>

<ol>
  <li>Python calls the <code class="language-plaintext highlighter-rouge">__str__</code> method of the <code class="language-plaintext highlighter-rouge">ndarray</code> object.</li>
  <li>NumPy’s <code class="language-plaintext highlighter-rouge">ndarray.__str__</code> method typically calls the internal function <code class="language-plaintext highlighter-rouge">_array_str_implementation</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">_array_str_implementation</code> checks for simple cases (like 0-dimensional arrays) and then calls the main workhorse: <code class="language-plaintext highlighter-rouge">array2string</code>.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">array2string</code></strong> (defined in <code class="language-plaintext highlighter-rouge">numpy/core/arrayprint.py</code>) takes the array and any specified options (like <code class="language-plaintext highlighter-rouge">precision</code>, <code class="language-plaintext highlighter-rouge">threshold</code>, etc.). It also reads the current default print options (managed by <code class="language-plaintext highlighter-rouge">numpy/core/printoptions.py</code> using context variables).</li>
  <li>It determines if the array needs <strong>summarization</strong> based on its <code class="language-plaintext highlighter-rouge">size</code> and the <code class="language-plaintext highlighter-rouge">threshold</code> option.</li>
  <li>It figures out the <strong>correct formatting function</strong> for the array’s <code class="language-plaintext highlighter-rouge">dtype</code> (e.g., <code class="language-plaintext highlighter-rouge">IntegerFormat</code>, <code class="language-plaintext highlighter-rouge">FloatingFormat</code>, <code class="language-plaintext highlighter-rouge">DatetimeFormat</code>). These formatters handle details like precision, sign, and scientific notation for individual elements. <code class="language-plaintext highlighter-rouge">FloatingFormat</code>, for example, might use the efficient <code class="language-plaintext highlighter-rouge">dragon4</code> algorithm (implemented in C) to convert floats to strings accurately.</li>
  <li>It recursively processes the array’s dimensions:
    <ul>
      <li>For each element (or summarized chunk), it calls the chosen formatting function to get its string representation.</li>
      <li>It arranges these strings, adding separators (like spaces or commas) and brackets (<code class="language-plaintext highlighter-rouge">[</code> <code class="language-plaintext highlighter-rouge">]</code>).</li>
      <li>It checks the <code class="language-plaintext highlighter-rouge">linewidth</code> and inserts line breaks and indentation as needed.</li>
      <li>If summarizing, it inserts the ellipsis (<code class="language-plaintext highlighter-rouge">...</code>) string (<code class="language-plaintext highlighter-rouge">summary_insert</code>).</li>
    </ul>
  </li>
  <li>Finally, <code class="language-plaintext highlighter-rouge">array2string</code> returns the complete, formatted string representation of the array.</li>
</ol>

<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant Python as print() / REPL
    participant NDArray as my_array object
    participant ArrayPrint as numpy.core.arrayprint module
    participant PrintOpts as numpy.core.printoptions module

    User-&gt;&gt;Python: print(my_array) or my_array
    Python-&gt;&gt;NDArray: call __str__ or __repr__
    NDArray-&gt;&gt;ArrayPrint: call array_str or array_repr
    ArrayPrint-&gt;&gt;ArrayPrint: call array2string(my_array, ...)
    ArrayPrint-&gt;&gt;PrintOpts: Get current print options (threshold, precision, etc.)
    ArrayPrint-&gt;&gt;ArrayPrint: Check size vs threshold -&gt; Summarize?
    ArrayPrint-&gt;&gt;ArrayPrint: Select Formatter based on my_array.dtype
    loop For each element/chunk
        ArrayPrint-&gt;&gt;ArrayPrint: Format element using Formatter
    end
    ArrayPrint-&gt;&gt;ArrayPrint: Arrange strings, add brackets, wrap lines
    ArrayPrint--&gt;&gt;NDArray: Return formatted string
    NDArray--&gt;&gt;Python: Return formatted string
    Python--&gt;&gt;User: Display formatted string
</code></pre>

<p>The core logic resides in <code class="language-plaintext highlighter-rouge">numpy/core/arrayprint.py</code>. This file contains <code class="language-plaintext highlighter-rouge">array2string</code>, <code class="language-plaintext highlighter-rouge">array_repr</code>, <code class="language-plaintext highlighter-rouge">array_str</code>, and various formatter classes (<code class="language-plaintext highlighter-rouge">FloatingFormat</code>, <code class="language-plaintext highlighter-rouge">IntegerFormat</code>, <code class="language-plaintext highlighter-rouge">BoolFormat</code>, <code class="language-plaintext highlighter-rouge">ComplexFloatingFormat</code>, <code class="language-plaintext highlighter-rouge">DatetimeFormat</code>, <code class="language-plaintext highlighter-rouge">TimedeltaFormat</code>, <code class="language-plaintext highlighter-rouge">StructuredVoidFormat</code>, etc.). The global print options themselves are managed using Python’s <code class="language-plaintext highlighter-rouge">contextvars</code> in <code class="language-plaintext highlighter-rouge">numpy/core/printoptions.py</code>, allowing settings to be changed globally or temporarily within a context.</p>

<h2 id="conclusion">Conclusion</h2>

<p>You’ve now learned how NumPy takes potentially huge and complex arrays and turns them into readable string representations using its <code class="language-plaintext highlighter-rouge">arrayprint</code> mechanism. Key takeaways:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">arrayprint</code> is NumPy’s “pretty printer” for arrays.</li>
  <li>It uses <strong>summarization</strong> (<code class="language-plaintext highlighter-rouge">threshold</code>, <code class="language-plaintext highlighter-rouge">edgeitems</code>) for large arrays.</li>
  <li>It controls <strong>formatting</strong> (like <code class="language-plaintext highlighter-rouge">precision</code>, <code class="language-plaintext highlighter-rouge">suppress</code> for floats) and <strong>layout</strong> (<code class="language-plaintext highlighter-rouge">linewidth</code>).</li>
  <li>You can customize printing <strong>globally</strong> (<code class="language-plaintext highlighter-rouge">set_printoptions</code>), <strong>temporarily</strong> (<code class="language-plaintext highlighter-rouge">printoptions</code> context manager), or for <strong>single calls</strong> (<code class="language-plaintext highlighter-rouge">array2string</code>).</li>
  <li>The core logic resides in <code class="language-plaintext highlighter-rouge">numpy/core/arrayprint.py</code>, using formatters tailored to different dtypes and reading options from <code class="language-plaintext highlighter-rouge">numpy/core/printoptions.py</code>.</li>
</ul>

<p>Understanding array printing helps you effectively inspect and share your NumPy data.</p>

<p>Next, we’ll start looking at the specific C and Python modules that form the core of NumPy’s implementation, beginning with the central <a href="06_multiarray_module.md">Chapter 6: multiarray Module</a>.</p>

<hr />

<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>
